---
title: How (and why) to increase the Windows Desktop heap size
date: 2008-01-15T17:04:00-05:00
---
Jon Galloway had a [posting about issues that he came across when he opened too many tabs in IE7](http://weblogs.asp.net/jgalloway/archive/2008/01/14/registry-setting-keeps-windows-from-wigging-out-when-you-open-lots-of-ie7-tabs.aspx "Jon Galloway: Registry setting keeps Windows from wigging out when you open lots of IE7 tabs").  Apparently the Desktop ran out of heap space and Bad Things happened.  [Jeff Atwood came across the same problem](http://www.codinghorror.com/blog/archives/000966.html "Coding Horror: Pushing Operating System Limits").  I remember reading Jeff&#8217;s post back in October, but I didn&#8217;t associate it with a problem that I was having.    

I was finding my self rebooting my XP dev box a couple of times a day.  The desktop was basically losing control and I couldn&#8217;t do anything with the task bar or Start Menu.  Part of the problem was due to [wonky](http://www.catb.org/~esr/jargon/html/W/wonky.html) display drivers from Nvidia.  I updated the drivers and the problem went mostly away.   But not completely.  I have a dual monitor setup, and I have a tendency to keep lots of things open on a desktop that spans both displays.

The longer I used Firefox, the less stable the system became.  I just became used to restarting Firefox.  One of the nicer things with Firefox is that you can restart it and come back to the same tabs loaded with the same pages.  BTW, [Jed Brown](https://addons.mozilla.org/en-US/firefox/user/6)&#8216;s [Restart Firefox](https://addons.mozilla.org/en-US/firefox/addon/1249) Add-on is very helpful when you want to bounce FireFox and still have the same 12 tabs open.

At any rate, I was seeing the same symptoms that Jon reported.  There is a registry setting that you can edit that will allow you to specify the heap size reserved for the Desktop.  The default size is 3MB, everybody seems to agree that 8MB is the way to go.  The [3MB number was set for NT 3.51](http://support.microsoft.com/kb/126962/ "KB 126962: "Out of Memory" error message appears when you have a large number of programs running"), back when we had a lot less memory in out machines.  This is only applicable for 32-bit versions of Windows, the 64-bit version do not have these memory limitations.

Kevin Dente [documented](http://weblogs.asp.net/kdente/archive/2004/06/04/148145.aspx "Kevin Dente: Windows XP flakiness - solved") how to bump this value.  To change this setting, you&#8217;ll need to edit the key **HKEY\_LOCAL\_MACHINE\SYSTEM\CurrentControlSet\Control\Session Manager\SubSystems** and edit the &#8220;Windows&#8221; value.  This value is (as Kevin put it) a &#8220;big honkin&#8217; string&#8221; and you only want to edit one portion of it.  Look for the part that starts with &#8220;SharedSection&#8221;.  It will have three numbers, the middle one will probably be 3072.  Change that to 8192.  On my machine, that part changed from &#8220;SharedSection=1024,3072,512&#8221; to SharedSection=1024,8192,512.  The [YMMV](http://www.catb.org/~esr/jargon/html/Y/Your-mileage-may-vary.html "Your mileage may vary") rule is especially applicable here.  Remember to reboot after making this change.

The [first number](http://support.microsoft.com/default.aspx?scid=kb;en-us;184802 "KB 184802: PRB: User32.dll or Kernel32.dll fails to initialize") is the shared heap size common to all desktops.  The global handle table comes out of the shared heap.  The [second](http://support.microsoft.com/default.aspx?scid=kb;EN-US;126962 "KB 126962: "Out of Memory" error message appears when you have a large number of programs running") and [third numbers](http://support.microsoft.com/default.aspx?scid=kb;EN-US;142676 "KB: 142676 Overcoming User32.dll Initialization Failure Errors") in SharedSection represent the size of interactive and non-interactive desktop heaps (services that interact with the desktop).  If terminal services are enabled, there may be a fourth number.  You only want to change the second number. 

<div>
  Tech Tags: <a href="http://technorati.com/tag/SharedSection" rel="tag">SharedSection</a> <a href="http://technorati.com/tag/XP" rel="tag">XP</a> <a href="http://technorati.com/tag/Memory" rel="tag">Memory</a> <a href="http://technorati.com/tag/Desktop" rel="tag">Desktop</a> <a href="http://technorati.com/tag/Heap" rel="tag">Heap</a>
</div>
