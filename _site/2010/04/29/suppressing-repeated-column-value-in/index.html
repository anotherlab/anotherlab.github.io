<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Suppressing a repeated column value in SQL | Chris Miller’s 4th Blog</title>
<meta name="generator" content="Jekyll v4.2.1" />
<meta property="og:title" content="Suppressing a repeated column value in SQL" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="I was asked by one of my co-workers for some SQL help. He needed a SQL statement that would suppress repeated column values for the result set. Basically the value would be shown for the first row and blanked for each successful row that had the same value. Typically you would handle this in the application code, we had a case where we had to pass data to another application and we needed to do this within a single SQL select statement." />
<meta property="og:description" content="I was asked by one of my co-workers for some SQL help. He needed a SQL statement that would suppress repeated column values for the result set. Basically the value would be shown for the first row and blanked for each successful row that had the same value. Typically you would handle this in the application code, we had a case where we had to pass data to another application and we needed to do this within a single SQL select statement." />
<link rel="canonical" href="http://localhost:4000/2010/04/29/suppressing-repeated-column-value-in/" />
<meta property="og:url" content="http://localhost:4000/2010/04/29/suppressing-repeated-column-value-in/" />
<meta property="og:site_name" content="Chris Miller’s 4th Blog" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2010-04-29T21:37:00-04:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Suppressing a repeated column value in SQL" />
<script type="application/ld+json">
{"datePublished":"2010-04-29T21:37:00-04:00","@type":"BlogPosting","url":"http://localhost:4000/2010/04/29/suppressing-repeated-column-value-in/","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/2010/04/29/suppressing-repeated-column-value-in/"},"dateModified":"2010-04-29T21:37:00-04:00","description":"I was asked by one of my co-workers for some SQL help. He needed a SQL statement that would suppress repeated column values for the result set. Basically the value would be shown for the first row and blanked for each successful row that had the same value. Typically you would handle this in the application code, we had a case where we had to pass data to another application and we needed to do this within a single SQL select statement.","headline":"Suppressing a repeated column value in SQL","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="Chris Miller's 4th Blog" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">Chris Miller&#39;s 4th Blog</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">About</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Suppressing a repeated column value in SQL</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2010-04-29T21:37:00-04:00" itemprop="datePublished">Apr 29, 2010
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p>I was asked by one of my co-workers for some SQL help. He needed a SQL statement that would suppress repeated column values for the result set. Basically the value would be shown for the first row and blanked for each successful row that had the same value. Typically you would handle this in the application code, we had a case where we had to pass data to another application and we needed to do this within a single SQL select statement.</p>

<p>For example if we have the values: &lt;/p&gt;</p>

<pre>username             Category<br />-------------------- ----------<br />Brian                cs<br />Tom                  cs<br />Joe                  cs<br />Allen                cs<br />Bill                 ts<br />Steven               ts<br />Fred                 ts<br />Ted                  ts</pre>

<p>We would want to return this as the output</p>

<pre>username             Category<br />-------------------- ----------<br />Brian                cs<br />Tom                  <br />Joe                  <br />Allen                <br />Bill                 ts<br />Steven               <br />Fred                 <br />Ted                  </pre>

<p>Using the following table structure:</p>

<pre name="code">create table test(id int, cat varchar(10), username varchar(20))</pre>

<p>We can make a query like</p>

<pre name="code">select t.username<br />,case<br />  when t.id = (select top 1 id <br />               from test t3 <br />               where t3.cat = t.cat <br />               order by t3.cat, t3.username) then t.cat<br />  else ''<br />end as Category<br />from test t<br />order by t.cat, t.username</pre>

<p>What the case keyword is doing is a sub-select on the same table and uses top 1 to match on only the first row for each set of categories.  If we match, we use the category value, otherwise we use an empty string value.  This is not very inefficient, you are doing the sub-select for each row of the query.  We needed to do this because the situation only allowed a single SQL statement to be executed.  We were working with a small set of records and this executed without any delay.</p>

<p>If you can call a stored procedure or execute a batch of SQL, you can split this up and gain a performance increase for larger sets of data.  Instead of doing the sub-select on each row, populate a <a href="http://www.sqlteam.com/article/using-table-variables">table variable</a> with the first row for each category.  Then do a <a href="http://www.w3schools.com/sql/sql_join_left.asp">left join</a> from the main table to the table variable.  The combined SQL would look something like this:</p>

<pre name="code">declare @q table(cat varchar(10), username varchar(20))<br />insert into @q(cat, username)<br />select t.cat, MIN(t.username)<br />from test t<br />group by t.cat<br /><br />select t.username, COALESCE(q.cat,'') as Category<br />from test t<br />left join @q q on t.cat = q.cat and t.username = q.username<br />order by t.cat, t.username</pre>

<p>Another way to get this affect is to use a <a href="http://msdn.microsoft.com/en-us/library/ms190766.aspx" title="Using Common Table Expressions">Common Table Expression</a> (CTE) as part of the query.  This would behave like the table variable, but you would have just a single select statement.  This would be useful for reporting tools where you can only specify a single SQL statement to retrieve the data.</p>

<p>Using the above example data, the new select statement would look like this</p>

<pre name="code">with cte as<br />(<br />  select cat, min(username) as username<br />  from test<br />  group by cat<br />)<br />select t.username, COALESCE(c.cat,'') as Category<br />from test t<br />left join cte c on t.username = c.username and c.cat = t.cat<br />order by t.cat, t.username<br /></pre>

<p>This query should be perform well (if not better) as the query with the table variable.</p>

  </div><a class="u-url" href="/2010/04/29/suppressing-repeated-column-value-in/" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Chris Miller&#39;s 4th Blog</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Chris Miller&#39;s 4th Blog</li><li><a class="u-email" href="mailto:your-email@example.com">your-email@example.com</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/anotherlab"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">anotherlab</span></a></li><li><a href="https://www.twitter.com/anotherlab"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">anotherlab</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>Write an awesome description for your new site here. You can edit this line in _config.yml. It will appear in your document head meta (for Google search results) and in your feed.xml site description.</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
