<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.7.1 -->
<title>InstallAware doesn’t automatically remove assemblies from the GAC at uninstall time | Chris Miller’s 4th Blog</title>
<meta name="generator" content="Jekyll v4.2.1" />
<meta property="og:title" content="InstallAware doesn’t automatically remove assemblies from the GAC at uninstall time" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="I am updating the installer for one of our products to check for the presence of the SP1 version of the .NET 2.0 Framework, when I noticed something odd.  The assemblies that I was putting into the GAC were still there after an uninstall.  The guys at InstallAware seem to think that this is not a problem.  They refer to a topic in the MSDN, Removal of Assemblies from the Global Assembly Cache, which describes how the Windows Installer is not responsible for the removal of entries in the GAC:" />
<meta property="og:description" content="I am updating the installer for one of our products to check for the presence of the SP1 version of the .NET 2.0 Framework, when I noticed something odd.  The assemblies that I was putting into the GAC were still there after an uninstall.  The guys at InstallAware seem to think that this is not a problem.  They refer to a topic in the MSDN, Removal of Assemblies from the Global Assembly Cache, which describes how the Windows Installer is not responsible for the removal of entries in the GAC:" />
<link rel="canonical" href="http://localhost:4000/2008/05/22/installaware-doesn-automatically-remove/" />
<meta property="og:url" content="http://localhost:4000/2008/05/22/installaware-doesn-automatically-remove/" />
<meta property="og:site_name" content="Chris Miller’s 4th Blog" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2008-05-22T16:43:00-04:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="InstallAware doesn’t automatically remove assemblies from the GAC at uninstall time" />
<script type="application/ld+json">
{"datePublished":"2008-05-22T16:43:00-04:00","@type":"BlogPosting","url":"http://localhost:4000/2008/05/22/installaware-doesn-automatically-remove/","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/2008/05/22/installaware-doesn-automatically-remove/"},"dateModified":"2008-05-22T16:43:00-04:00","description":"I am updating the installer for one of our products to check for the presence of the SP1 version of the .NET 2.0 Framework, when I noticed something odd.  The assemblies that I was putting into the GAC were still there after an uninstall.  The guys at InstallAware seem to think that this is not a problem.  They refer to a topic in the MSDN, Removal of Assemblies from the Global Assembly Cache, which describes how the Windows Installer is not responsible for the removal of entries in the GAC:","headline":"InstallAware doesn’t automatically remove assemblies from the GAC at uninstall time","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="Chris Miller's 4th Blog" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">Chris Miller&#39;s 4th Blog</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">About</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">InstallAware doesn&amp;#8217;t automatically remove assemblies from the GAC at uninstall time</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2008-05-22T16:43:00-04:00" itemprop="datePublished">May 22, 2008
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p>I am updating the installer for one of our products to check for the presence of the SP1 version of the .NET 2.0 Framework, when I noticed something odd.  The assemblies that I was putting into the GAC were still there after an uninstall.  The guys at <a href="http://www.installaware.com/">InstallAware</a> seem to think that this is not a problem.  They refer to a topic in the MSDN, <a href="http://msdn.microsoft.com/en-us/library/aa371192.aspx">Removal of Assemblies from the Global Assembly Cache</a>, which describes how the Windows Installer is not responsible for the removal of entries in the GAC:</p>

<blockquote>
  <p>The Windows Installer determines whether to allow the removal of a common language runtime assembly based upon a client list it keeps independently of the assembly. The Windows Installer keeps one pin bit to represent Windows Installer clients of the assembly. The installer pins the assembly for the first Windows Installer client and unpins it when the last Windows Installer client is removed. The assembly maintains a pin bit for every client of an assembly.</p>

  <p>The Windows Installer is not directly responsible for the physical removal of common language runtime assemblies from the computer. The installer unpins the assembly when the last Windows Installer client is removed. If the Windows Installer is the last client of the assembly, the common language runtime provides the option to force a synchronous cleanup of the assembly. The cleanup process is atomic and there is no provision for a “rollback” at this point. All unpinning of common language runtime assemblies must occur after the user has had a chance to cancel the installation or removal.</p>
</blockquote>

<p>That being said, the users want to uninstall everything.  Wise and InstallShield apparently do this.  With InstallShield, there is a property for the installed file called “Permanent”.  If it’s not set, it will be removed from the GAC if there are no other references to the assembly.</p>

<p>What InstallAware wants you to do is to explicitly remove the assembly during the uninstall portion of the install script.  They provide a command named “Remove Unpinned Assemblies” (it’s listed as “Remove Assemblies”).  This command will remove all unpinned assemblies that your installer had places into the GAC.  The code should look like this: </p>

<pre>Apply Uninstall (get result into variable SUCCESS)<br />  Remove Unpinned Assemblies</pre>

<p>I’m still not sure if that will always work.  According to InstallAware, there is a bug in Windows Installer where sometimes the installer corrupts the Global Registry cache on .NET 2.0 assembles and there will always be a reference to unreferenced assembly.  The only work around is to delete the (Default) registry key for the assembly in the user and local machine hives.  This mess is documented <a href="http://www.installaware.com/forums/viewtopic.php?t=2589" title="InstallAware :: View topic - Using Remove Assemblies">here</a> in the InstallAware support forum.</p>

<p>The work around sounds worse than the problem.  I’m not going to do a strafing run on the registry to deal with a Windows Installer bug.  Not when the only consequence is that a few assemblies (in my case, it’s only a few) get left in the GAC.  There are other ways of removing assemblies from the GAC.  The <a href="http://msdn.microsoft.com/en-us/library/ex0ss12c(VS.80).aspx">gacutil.exe</a> utility can be used to check the reference count and to remove the assembly,  The “/lr” command line parameter will list the reference counts for each assembly.  The “/u” parameter will remove an assenbly from the GAC.  For the command-line shy, the free tool <a href="http://www.nirsoft.net/dot_net_tools/gac_viewer.html" title="GACView v1.11 - Global Assembly Cache (GAC) Viewer">GacView</a> provides an Explorer like view of the GAC and it’s easy to use to remove assemblies from the GAC.</p>

  </div><a class="u-url" href="/2008/05/22/installaware-doesn-automatically-remove/" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Chris Miller&#39;s 4th Blog</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Chris Miller&#39;s 4th Blog</li><li><a class="u-email" href="mailto:your-email@example.com">your-email@example.com</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/anotherlab"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">anotherlab</span></a></li><li><a href="https://www.twitter.com/anotherlab"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">anotherlab</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>Write an awesome description for your new site here. You can edit this line in _config.yml. It will appear in your document head meta (for Google search results) and in your feed.xml site description.</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
