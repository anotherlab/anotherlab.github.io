<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Controlling a WSL installation of redis-server from the Windows command line | Chris Miller’s 4th Blog</title>
<meta name="generator" content="Jekyll v4.2.1" />
<meta property="og:title" content="Controlling a WSL installation of redis-server from the Windows command line" />
<meta name="author" content="Chris Miller" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Some shortcuts accessing redis-server running under WSL via PowerShell" />
<meta property="og:description" content="Some shortcuts accessing redis-server running under WSL via PowerShell" />
<link rel="canonical" href="http://localhost:4000/2021/10/18/controlling-a-wsl-installation-of-redis-server-from-the-windows-command-line/" />
<meta property="og:url" content="http://localhost:4000/2021/10/18/controlling-a-wsl-installation-of-redis-server-from-the-windows-command-line/" />
<meta property="og:site_name" content="Chris Miller’s 4th Blog" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-10-19T00:53:13-04:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Controlling a WSL installation of redis-server from the Windows command line" />
<script type="application/ld+json">
{"datePublished":"2021-10-19T00:53:13-04:00","@type":"BlogPosting","url":"http://localhost:4000/2021/10/18/controlling-a-wsl-installation-of-redis-server-from-the-windows-command-line/","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/2021/10/18/controlling-a-wsl-installation-of-redis-server-from-the-windows-command-line/"},"dateModified":"2021-10-19T00:53:13-04:00","author":{"@type":"Person","name":"Chris Miller"},"description":"Some shortcuts accessing redis-server running under WSL via PowerShell","headline":"Controlling a WSL installation of redis-server from the Windows command line","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="Chris Miller's 4th Blog" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">Chris Miller&#39;s 4th Blog</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">About</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Controlling a WSL installation of redis-server from the Windows command line</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2021-10-19T00:53:13-04:00" itemprop="datePublished">Oct 19, 2021
      </time>• <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span class="p-author h-card" itemprop="name">Chris Miller</span></span></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p>If you like using <a href="https://redis.io/">redis</a> for web site caching and you are writing and testing code locally from Windows, you’ll want to figure out how to run a local instance of redis-server. You have a few options. You can run it from another machine that’s running something vaguely Linux-like or MacOS. You can run it from a Docker container under Windows. Or you can run it directly from <a href="http://Windows SubSystem (WSL) for Linux" data-wplink-url-error="true">Windows SubSystem (WSL) for Linux</a>.</p>

<p>For the last few years, Windows (10, 11, Server 2019) comes with a compatibility layer that lets you run Linux binary executables. The current version is WSL 2, but I’m just going to refer to it as WSL.  If you don’t have installed already, just run the following command from an elevated shell (run as administrator)</p>

<div class="wp-block-syntaxhighlighter-code ">
  <pre class="brush: powershell; gutter: false; title: ; notranslate" title="">
wsl --install
</pre>
</div>
<figure class="wp-block-image size-large">

<img src="https://i2.wp.com/photos.smugmug.com/Blog/n-zwT5d/2021/i-pTtQzxz/0/0a5988c8/L/02%20-%20wsl-install-L.png?w=680&#038;ssl=1" alt="Installing WSl via command line" data-recalc-dims="1" /> <figcaption>Installing WSl via command line</figcaption></figure>

<p>It will install the bits that you need and then ask you to reboot your machine. For more information about installing and configuring WSL, Microsoft has some really good documentation at <a href="https://docs.microsoft.com/en-us/windows/wsl/install">Install WSL</a>.</p>

<p>The default Linux distribution for WSL is Ubuntu. After you reboot, you may see a Ubuntu shell for a while as Windows installs the bits that you need. It will churn for a bit and then ask you for a username and password. That password will be your sudo (user root) password. One that is done, you should see something like this.<figure class="wp-block-image size-large"></figure></p>

<p><img src="https://i2.wp.com/photos.smugmug.com/Blog/n-zwT5d/2021/i-43gLWHP/0/54984ae6/L/02%20-%20ubuntu-install-L.png?w=680&#038;ssl=1" alt="Final step of installing WSL is configuring the default Linux distribution" data-recalc-dims="1" /> &lt;figcaption&gt;Final step of installing WSL is configuring the default Linux distribution&lt;/figcaption&gt;&lt;/figure&gt;</p>

<p>The next thing to do is to install redis-server. We can install redis vis <a href="https://en.wikipedia.org/wiki/APT_(software)">apt-get</a>, but before we do that, we need to update apt-get and remove some of the new install shininess off.</p>

<div class="wp-block-syntaxhighlighter-code ">
  <pre class="brush: bash; gutter: false; title: ; notranslate" title="">
sudo apt-get update
sudo apt-get upgrade
</pre>
</div>

<p>After updating apt-get, you’ll want to upgrade it. Confusing? Sort of. Update is updating the instance of apt-get, upgrade is updating all of the packages that were installed via apt-get. After that has finished, you can install redis-server</p>

<div class="wp-block-syntaxhighlighter-code ">
  <pre class="brush: bash; gutter: false; title: ; notranslate" title="">
sudo apt-get install redis-server
</pre>
</div>

<p>There will be some churn and finally, it be installed. Out of the box, redis will not be running. My personal preference is to only run redis when I’m actually using it for development. So I Iike to start and stop it from the command line. Here are commands that you need to know:</p>

<div class="wp-block-syntaxhighlighter-code ">
  <pre class="brush: bash; gutter: false; title: ; notranslate" title="">
sudo service redis-server status
sudo service redis-server start
sudo service redis-server stop
</pre>
</div>

<p>I’ll start up redis with the service start command, and it will come back with a message that redis is starting. And you can use the service status command to verify that it’s running. The acid test is to connect to redis and see if it’s working. You can use the redis-cli tool to set and get a cache value. You should see something like this.<figure class="wp-block-image size-large"></figure></p>

<p><img src="https://i2.wp.com/photos.smugmug.com/Blog/n-zwT5d/2021/i-vLhVGKK/0/6aaf4c9d/O/04%20-%20redis-cli.png?w=680&#038;ssl=1" alt="Running redis-cli from the Ubuntu shell" data-recalc-dims="1" /> &lt;figcaption&gt;Running redis-cli from the Ubuntu shell&lt;/figcaption&gt;&lt;/figure&gt;</p>

<p>So now redis-server is running. If you close the shell and open up a new one, it will still be running. If you restart WSL or Windows, then it wont be running. Now you can always pop open an Ubuntu shell and start redis-server, but you can do it from a Windows command line</p>

<div class="wp-block-syntaxhighlighter-code ">
  <pre class="brush: powershell; gutter: false; title: ; notranslate" title="">
wsl sudo service redis-server status
</pre>
</div>
<figure class="wp-block-image size-large">

<img src="https://i2.wp.com/photos.smugmug.com/Blog/n-zwT5d/2021/i-ffr3dZN/0/71f62819/O/05%20-%20redis-pwsh.png?w=680&#038;ssl=1" alt="Running redis commands from PowerShell" data-recalc-dims="1" /> <figcaption>Running redis commands from PowerShell</figcaption></figure>

<p>From the screenshot, you can see that WSL passed along the sudo service command to Ubunto. And because I used sudo, I was prompted for the root password. And it returned the same message that I would see from the Ubuntu shell. Since I only have Ubunto installed, that was the default Linux that received the command. If you have multiple distributions installed, you would use “wsl -d DistributionName”. You can get the names of the installed distributions with the “wsl -l” command. Unlike from the Linux shell, each time I invoke “sudo”, I’m prompted for the password. In the Linux shell, you are prompted just the first time you call sudo in a terminal session.</p>

<p>Having to use the root password over and over again can be tedious on a development box. There is a way around that. You can add a file to the /etc/sudoers.d folder in the Linux distribution and remove the root password requirement for the redis-server service. From the Linux shell do the following</p>

<div class="wp-block-syntaxhighlighter-code ">
  <pre class="brush: bash; gutter: false; title: ; notranslate" title="">
cd /etc/sudoers.d
sudo sh
echo "%sudo ALL=(ALL) NOPASSWD: /usr/sbin/service redis-server *" &gt;&gt; allowed-services
sudo chmod 0440 allowed-services
exit
</pre>
</div>
<figure class="wp-block-image size-large">

<img src="https://i1.wp.com/photos.smugmug.com/Blog/n-zwT5d/2021/i-bdhLSQW/0/003b70be/O/06%20-%20sudoers.png?w=680&#038;ssl=1" alt="" data-recalc-dims="1" /> </figure>

<p>The first thing we do is make /etc/sudoers.d the current folder. Then we use “sudo sh” to gain root access. You need root access to work with this folder. The echo line basically says that you can invoke sudo with no password for redis-server and writes that setting to a file named allowed-services. The file name allowed-services is arbitrary, I picked it because it made sense to me. There is a file in the sudoers.d folder named README, it will explain what the file name restrictions are.</p>

<p>The chmod 0440 command sets the permissions to read-only for the root account and is required for sudoers.d. This allows us to remove the sudo password requirement for redis-server and only for redis-server. Now we can go back to the Windows shell and run the wsl commands without being prompted.</p>

<p>You can even run the redis-cli tool from powershell…<figure class="wp-block-image size-large"></figure></p>

<p><img src="https://i2.wp.com/photos.smugmug.com/Blog/n-zwT5d/2021/i-5jWGFRF/0/c4e9ba5e/O/07%20-%20redis-pwsh.png?w=680&#038;ssl=1" alt="Redis from PowerShell, no password" data-recalc-dims="1" /> &lt;figcaption&gt;Redis from PowerShell, no password&lt;/figcaption&gt;&lt;/figure&gt;</p>

<p>The WIndows Subsystem for Linux is one of the hidden gems for developers. And this gem sparkles…</p>

<p><strong>Bonus Round!</strong></p>

<p>Because I’m lazy, I created shortcuts in my PowerShell profile. I added the following functions:</p>

<div class="wp-block-syntaxhighlighter-code ">
  <pre class="brush: powershell; gutter: false; title: ; notranslate" title="">
function redstat {wsl sudo service redis-server status}
function redstart {wsl sudo service redis-server start}
</pre>
</div>

<p>And now I can just check the redis-server status via “redstat”<figure class="wp-block-image size-large"></figure></p>

<p><img src="https://i0.wp.com/photos.smugmug.com/Blog/n-zwT5d/2021/i-MBk5v8J/0/afa5b1b0/O/08-redstat.png?w=680&#038;ssl=1" alt="" data-recalc-dims="1" /> &lt;/figure&gt;</p>

  </div><a class="u-url" href="/2021/10/18/controlling-a-wsl-installation-of-redis-server-from-the-windows-command-line/" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Chris Miller&#39;s 4th Blog</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Chris Miller&#39;s 4th Blog</li><li><a class="u-email" href="mailto:your-email@example.com">your-email@example.com</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/anotherlab"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">anotherlab</span></a></li><li><a href="https://www.twitter.com/anotherlab"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">anotherlab</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>Write an awesome description for your new site here. You can edit this line in _config.yml. It will appear in your document head meta (for Google search results) and in your feed.xml site description.</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
