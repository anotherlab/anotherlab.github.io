<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.26.2 by Michael Rose
  Copyright 2013-2024 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->

<html lang="en-US" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>How to access Apple’s App Connect API from C#, Python, and Go. - Part 3 - Chris Miller’s 5th Blog</title>
<meta name="description" content="">


  <meta name="author" content="Chris Miller">
  
  <meta property="article:author" content="Chris Miller">
  


<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="Chris Miller's 5th Blog">
<meta property="og:title" content="How to access Apple’s App Connect API from C#, Python, and Go. - Part 3">
<meta property="og:url" content="http://localhost:4000/2021/07/19/how-to-access-apples-app-connect-api-from-c-python-and-go-part-3/">


  <meta property="og:description" content="">





  <meta name="twitter:site" content="@anotherlab">
  <meta name="twitter:title" content="How to access Apple’s App Connect API from C#, Python, and Go. - Part 3">
  <meta name="twitter:description" content="">
  <meta name="twitter:url" content="http://localhost:4000/2021/07/19/how-to-access-apples-app-connect-api-from-c-python-and-go-part-3/">

  
    <meta name="twitter:card" content="summary">
    
  

  



  <meta property="article:published_time" content="2021-07-19T13:28:15+00:00">






<link rel="canonical" href="http://localhost:4000/2021/07/19/how-to-access-apples-app-connect-api-from-c-python-and-go-part-3/">












<!-- end _includes/seo.html -->



  <link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Chris Miller's 5th Blog Feed">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script type="text/javascript">
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
  
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@latest/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@latest/css/all.min.css"></noscript>



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--single">
    <nav class="skip-links">
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
        <a class="site-title" href="/">
          Chris Miller's 5th Blog
          
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a
                href="/posts/"
                
                
              >Posts</a>
            </li><li class="masthead__menu-item">
              <a
                href="/categories/"
                
                
              >Categories</a>
            </li><li class="masthead__menu-item">
              <a
                href="/tags/"
                
                
              >Tags</a>
            </li><li class="masthead__menu-item">
              <a
                href="/about/"
                
                
              >About</a>
            </li></ul>
        
        <button class="search__toggle" type="button">
          <span class="visually-hidden">Toggle search</span>
          <i class="fas fa-search"></i>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      





<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person" class="h-card">

  
    <div class="author__avatar">
      <a href="http://localhost:4000/">
        <img src="https://assets.about.me/background/users/t/h/i/thisischrismiller_1488935098_536.jpg" alt="Chris Miller" itemprop="image" class="u-photo">
      </a>
    </div>
  

  <div class="author__content">
    <h3 class="author__name p-name" itemprop="name">
      <a class="u-url" rel="me" href="http://localhost:4000/" itemprop="url">Chris Miller</a>
    </h3>
    
      <div class="author__bio p-note" itemprop="description">
        <p>I am a Microsoft MVP, a Pluralsight Author, a Xamarin Certified Mobile Developer for iOS and Android, and the leader of the Tech Valley .NET User Group.</p>

      </div>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope itemtype="https://schema.org/Place">
          <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name" class="p-locality">Albany, NY</span>
        </li>
      

      
        
          
            <li><a href="https://" rel="nofollow noopener noreferrer me" itemprop="sameAs"><i class="fas fa-fw fa-link" aria-hidden="true"></i><span class="label">Website</span></a></li>
          
        
          
            <li><a href="https://bsky.app/profile/anotherlab.bsky.social" rel="nofollow noopener noreferrer me" itemprop="sameAs"><i class="fab fa-fw fa-bluesky" aria-hidden="true"></i><span class="label">BlueSky</span></a></li>
          
        
          
            <li><a href="https://app.pluralsight.com/profile/author/christopher-miller" rel="nofollow noopener noreferrer me" itemprop="sameAs"><i class="fas fa-fw fa-chalkboard-teacher" aria-hidden="true"></i><span class="label">Pluralsight</span></a></li>
          
        
          
            <li><a href="https://github.com/anotherlab" rel="nofollow noopener noreferrer me" itemprop="sameAs"><i class="fab fa-fw fa-github" aria-hidden="true"></i><span class="label">GitHub</span></a></li>
          
        
          
            <li><a href="https://www.linkedin.com/in/christophermiller/" rel="nofollow noopener noreferrer me" itemprop="sameAs"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span class="label">LinkedIn</span></a></li>
          
        
          
            <li><a href="https://instagram.com/anotherlab" rel="nofollow noopener noreferrer me" itemprop="sameAs"><i class="fab fa-fw fa-instagram" aria-hidden="true"></i><span class="label">Instagram</span></a></li>
          
        
          
            <li><a href="https://mvp.microsoft.com/en-us/PublicProfile/5000200" rel="nofollow noopener noreferrer me" itemprop="sameAs"><i class="fas fa-fw fa-award" aria-hidden="true"></i><span class="label">Microsoft MVP</span></a></li>
          
        
          
            <li><a href="https://stackoverflow.com/users/206/chris-miller" rel="nofollow noopener noreferrer me" itemprop="sameAs"><i class="fab fa-fw fa-stack-overflow" aria-hidden="true"></i><span class="label">Stack Overflow</span></a></li>
          
        
          
            <li><a href="https://www.reddit.com/user/anotherlab/" rel="nofollow noopener noreferrer me" itemprop="sameAs"><i class="fab fa-fw fa-reddit-alien" aria-hidden="true"></i><span class="label">Reddit</span></a></li>
          
        
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer me">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>



  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="How to access Apple’s App Connect API from C#, Python, and Go. - Part 3">
    <meta itemprop="description" content="">
    <meta itemprop="datePublished" content="2021-07-19T13:28:15+00:00">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">
            <a href="http://localhost:4000/2021/07/19/how-to-access-apples-app-connect-api-from-c-python-and-go-part-3/" itemprop="url">How to access Apple’s App Connect API from C#, Python, and Go. - Part 3
</a>
          </h1>
          

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          13 minute read
        
      </span>
    
  </p>


        </header>
      

      <section class="page__content" itemprop="text">
        
        <figure><img src="https://i1.wp.com/photos.smugmug.com/Blog/n-zwT5d/2021/i-MdwkwLM/0/e733f438/L/Apple%20Lock%20Purple-L.jpg?" alt="" /></figure>

<p>In my <a href="/2021/07/09/how-to-access-apples-app-connect-api-from-c-python-and-go-part-1/">first post</a>, I wrote about a need to query my company’s membership list from our Apple app store development account. In that post, I used C# to query Apple’s API. <a href="/2021/07/12/how-to-access-apples-app-connect-api-from-c-python-and-go-part-2/">Part 2</a> covered the Python version. For our final installment, we’ll cover how to accomplish the same task with <a href="https://golang.org/">Go</a>.</p>

<p>As with the C# and Python versions, we’ll need to create a signed Javascript Web Token (JWT) and then make some API calls. I have the code in a Github repository. You can clone it from <a href="https://github.com/anotherlab/IsUserInApple-golang">here</a>. As with the C# project, the code is spread over a couple of modules.</p>

<p>The code should be portable across platforms. I used Go 1.13.2 on Windows. If you don’t have Go installed, you can grab it from the download page at <a href="https://golang.org/dl/">golang.org</a>. This would be a good place to mention that the only experience that I have with Go is what I learned from writing this applet. I’m pretty comfortable with C#, but everything that I know about Python and Go came from writing this code.</p>

<p>That disclaimer in place, after you install Go, you can grab the code from the <a href="https://github.com/anotherlab/IsUserInApple-golang">repository</a> and follow along. As with the other projects, we use a 3rd party library to generate and sign the Javascript Web Token (JWT). When I wrote the code a couple of months ago, I used dgrijalva’s <a href="https://github.com/dgrijalva/jwt-go">jwt-go</a> library. It’s no longer being maintained and it recomends to use a community supported clone of that project, <a href="https://github.com/golang-jwt/jwt">golang-jwt/jwt</a>. While writing this blog post, I updated the code to use the community supported project.</p>

<div>
  <div>
    If you clone the code from my repo, the jwt library should get downloaded when you build the code. If it doesn&#8217;t you can install it the following command
  </div>
</div>

<pre class="wp-block-code"><code>go get github.com/golang-jwt/jwt</code></pre>

<p>Before we run the code, lets take a tour of the code. The entry point is the module <a href="https://github.com/anotherlab/IsUserInApple-golang/blob/main/AppleStoreApi.go">IsUserInApple.go</a>. You can follow along with the code from the repo. It will differ from the C# and Python versions by having named command line parameters. We start with the following code</p>

<figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre></td><td class="code"><pre><span class="n">package</span> <span class="n">main</span>

<span class="nf">import</span> <span class="p">(</span>
	<span class="s">"flag"</span>
	<span class="s">"fmt"</span>
	<span class="s">"os"</span>
	<span class="s">"path/filepath"</span>
<span class="p">)</span>

<span class="n">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="c1">// Define command line options</span>
	<span class="n">configPtr</span> <span class="p">:=</span> <span class="n">flag</span><span class="p">.</span><span class="nf">String</span><span class="p">(</span><span class="s">"config"</span><span class="p">,</span> <span class="s">"./IsUserInApple.json"</span><span class="p">,</span> <span class="s">"Configuration file"</span><span class="p">)</span>
	<span class="n">usernamePtr</span> <span class="p">:=</span> <span class="n">flag</span><span class="p">.</span><span class="nf">String</span><span class="p">(</span><span class="s">"username"</span><span class="p">,</span> <span class="s">""</span><span class="p">,</span> <span class="s">"Username to find (in quotes)"</span><span class="p">)</span>

	<span class="n">flag</span><span class="p">.</span><span class="nf">Parse</span><span class="p">()</span>

	<span class="kt">var</span> <span class="n">userName</span> <span class="kt">string</span> <span class="p">=</span> <span class="p">*</span><span class="n">usernamePtr</span>
	<span class="kt">var</span> <span class="n">ConfigFileName</span> <span class="kt">string</span> <span class="p">=</span> <span class="p">*</span><span class="n">configPtr</span>
</pre></td></tr></tbody></table></code></pre></figure>

<p>At line 4, we import the <a href="https://pkg.go.dev/flag">flag</a> module. This module makes it simple to define and read command line parameters. We’ll define 2 parameters, one for the name of the config file (line 12), the second for the name to match (line 13). For our code, we’ll define them as string variables. We pass in the name of the command line parameter, default value, and the help text.</p>

<p>After defining the parameters, we call <a href="https://pkg.go.dev/flag#Parse">flag.Parse()</a> to parse the command line parameters that are being passed in. Lines 17-18 assign the flag values to string variables. This code could probably be written with less code, but it works and it’s readable. The next bit of code checks to see if a username was passed. If it doesn’t, it prints the command line help and then quietly dies a good death.</p>

<figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="code"><pre><span class="k">if</span> <span class="nf">len</span><span class="p">(</span><span class="n">userName</span><span class="p">)</span> <span class="p">==</span> <span class="m">0</span> <span class="p">{</span>
	<span class="n">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">"Please specify an email address to match (in quotes)"</span><span class="p">)</span>
	<span class="n">flag</span><span class="p">.</span><span class="nf">PrintDefaults</span><span class="p">()</span>
	<span class="n">os</span><span class="p">.</span><span class="nf">Exit</span><span class="p">(</span><span class="m">1</span><span class="p">)</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></figure>

<p>The next few lines check to see if a config file was specified.</p>

<figure class="highlight"><pre><code class="language-plain" data-lang="plain"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="code"><pre>if len(ConfigFileName) == 0 {
	ex, err := os.Executable()
	if err != nil {
		panic(err)
	}
	ConfigFileName = filepath.Join(filepath.Dir(ex), "IsUserInApple.json")
}

if _, err := os.Stat(ConfigFileName); os.IsNotExist(err) {
	fmt.Println(err)
	os.Exit(2)
}
</pre></td></tr></tbody></table></code></pre></figure>

<p>At line 1, we see if a file has been specified. It hasn’t been specified, then we want to look in the folder that code is running from from for a file named IsUserInApple.json. The <a href="https://pkg.go.dev/os#Executable">os.Executable()</a> method will return the full path for the running code, or an error message if something went wrong. If that happens, we abandon ship with <a href="https://gobyexample.com/panic">panic()</a>.</p>

<p>If you are new to Go, it’s a little wierd to see both a return value and error message on the left side of a function call. But you get used to it after a while. And it’s a very clean way of getting errors back from a method call. After getting the path, we extract the directory and concatenate the name of the config file. At line 9, we check to see if the file exists or die trying.</p>

<p>At this point we have a filename for the configuration file and we can attempt to read it.</p>

<figure class="highlight"><pre><code class="language-plain" data-lang="plain">fmt.Println("Looking for " + userName)

config, err := ReadConfig(ConfigFileName)</code></pre></figure>

<p>Time to dive into the ReadConfig() method. That code is in the <a href="https://github.com/anotherlab/IsUserInApple-golang/blob/main/AppleJWT.go">AppleJWT.go</a> module. It’s not the cleanest separation of code, but just roll with it. We have a bunch of fun things going on here. First things first are the imports:</p>

<figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="code"><pre><span class="nf">import</span> <span class="p">(</span>
	<span class="s">"crypto/ecdsa"</span>
	<span class="s">"crypto/x509"</span>
	<span class="s">"encoding/json"</span>
	<span class="s">"encoding/pem"</span>
	<span class="s">"fmt"</span>
	<span class="s">"io/ioutil"</span>
	<span class="s">"log"</span>
	<span class="s">"time"</span>

	<span class="s">"github.com/golang-jwt/jwt"</span>
<span class="p">)</span>
</pre></td></tr></tbody></table></code></pre></figure>

<p>The first 8 imports are modules that come with Go. The crypto modules are used for the JWT signing. The encoding modules let us read and parse JSON and PEM data. The last module is the external library that will be pulled directly from Github.</p>

<p>Now we’ll define an object to contain the JSON data from the config file. This is a pretty simple object:</p>

<figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="code"><pre><span class="n">type</span> <span class="n">ConfigSettings</span> <span class="k">struct</span> <span class="err">{</span>
	<span class="nc">PrivateKeyFile</span> <span class="kt">string</span> <span class="err">`</span><span class="n">json</span><span class="p">:</span><span class="s">"PrivateKeyFile"</span><span class="err">`</span>
	<span class="n">KeyID</span>          <span class="kt">string</span> <span class="err">`</span><span class="n">json</span><span class="p">:</span><span class="s">"KeyID"</span><span class="err">`</span>
	<span class="n">IssuerID</span>       <span class="kt">string</span> <span class="err">`</span><span class="n">json</span><span class="p">:</span><span class="s">"IssuerID"</span><span class="err">`</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></figure>

<p>That will map to the JSON format of the config file, which will look like this</p>

<figure class="highlight"><pre><code class="language-jscript" data-lang="jscript"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="code"><pre>{
    "PrivateKeyFile": "path/to.your/privatekey.p8",
    "KeyID": "ABCDEF1234",
    "IssuerID": "d88b7c23-4c26-48fb-9d62-5649f27a25a2"
}
</pre></td></tr></tbody></table></code></pre></figure>

<p>There are some handy online tools from converting JSON data to Go structs. I have used <a href="https://mholt.github.io/json-to-go/">JSON-to-Go</a> and <a href="https://transform.tools/json-to-go">transform.tools</a>, they both work pretty well. The JSON-to-Go tool gives you the option of using inline type definitions or separate structs for each type. After that we have the ReadConfig method</p>

<figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td><td class="code"><pre><span class="n">func</span> <span class="nf">ReadConfig</span><span class="p">(</span><span class="n">ConfigFileName</span> <span class="kt">string</span><span class="p">)</span> <span class="p">(*</span><span class="n">ConfigSettings</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span> <span class="p">{</span>
	<span class="n">file</span><span class="p">,</span> <span class="n">err</span> <span class="p">:=</span> <span class="n">ioutil</span><span class="p">.</span><span class="nf">ReadFile</span><span class="p">(</span><span class="n">ConfigFileName</span><span class="p">)</span>

	<span class="k">if</span> <span class="n">err</span> <span class="p">!=</span> <span class="n">nil</span> <span class="p">{</span>
		<span class="k">return</span> <span class="n">nil</span><span class="p">,</span> <span class="n">err</span>
	<span class="p">}</span>

	<span class="n">config</span> <span class="p">:=</span> <span class="k">new</span><span class="p">(</span><span class="n">ConfigSettings</span><span class="p">)</span>

	<span class="n">err</span> <span class="p">=</span> <span class="n">json</span><span class="p">.</span><span class="nf">Unmarshal</span><span class="p">([]</span><span class="kt">byte</span><span class="p">(</span><span class="n">file</span><span class="p">),</span> <span class="p">&amp;</span><span class="n">config</span><span class="p">)</span>

	<span class="k">return</span> <span class="n">config</span><span class="p">,</span> <span class="n">err</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></figure>

<p>Line 1 defines the parameters, the name of the config file, and an error variable. Then we read the file at line 2 with the <a href="https://pkg.go.dev/io/ioutil#ReadFile">ReadFile</a> method. If it fails, we return the error. At line 8, we create a new instance of the ConfigSettings struct that will contain our settings. Then at line 10, we use the <a href="https://pkg.go.dev/encoding/json#Unmarshal">Unmarshal()</a> method to parse the JSON data into our ConfigSettings struct.</p>

<p>That brings us back to our main method.</p>

<figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="code"><pre><span class="k">if</span> <span class="n">err</span> <span class="p">!=</span> <span class="n">nil</span> <span class="p">{</span>
	<span class="n">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
	<span class="n">os</span><span class="p">.</span><span class="nf">Exit</span><span class="p">(</span><span class="m">3</span><span class="p">)</span>
<span class="p">}</span>

<span class="nf">CheckUserList</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">userName</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></pre></figure>

<p>Skipping over error checking code, we now have the method that will ties this all together for us. Now we can dive in to CheckUserList() defined in <a href="https://github.com/anotherlab/IsUserInApple-golang/blob/main/AppleStoreApi.go">AppleStoreApi.go</a>. At the top of module, we have some structs defined.</p>

<figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
</pre></td><td class="code"><pre><span class="n">type</span> <span class="n">AppConnectUsers</span> <span class="p">=</span> <span class="k">struct</span> <span class="err">{</span>
	<span class="nc">Data</span>  <span class="p">[]</span><span class="n">Datum</span>              <span class="err">`</span><span class="n">json</span><span class="p">:</span><span class="s">"data"</span><span class="err">`</span>
	<span class="n">Links</span> <span class="n">AppConnectUsersLinks</span> <span class="err">`</span><span class="n">json</span><span class="p">:</span><span class="s">"links"</span><span class="err">`</span>
<span class="p">}</span>

<span class="n">type</span> <span class="n">Datum</span> <span class="p">=</span> <span class="k">struct</span> <span class="err">{</span>
	<span class="nc">Type</span>       <span class="kt">string</span>     <span class="err">`</span><span class="n">json</span><span class="p">:</span><span class="s">"type"</span><span class="err">`</span>
	<span class="n">Attributes</span> <span class="n">Attributes</span> <span class="err">`</span><span class="n">json</span><span class="p">:</span><span class="s">"attributes"</span><span class="err">`</span>
<span class="p">}</span>

<span class="n">type</span> <span class="n">Attributes</span> <span class="p">=</span> <span class="k">struct</span> <span class="err">{</span>
	<span class="nc">Username</span>  <span class="kt">string</span>   <span class="err">`</span><span class="n">json</span><span class="p">:</span><span class="s">"username"</span><span class="err">`</span>
	<span class="n">FirstName</span> <span class="kt">string</span>   <span class="err">`</span><span class="n">json</span><span class="p">:</span><span class="s">"firstName"</span><span class="err">`</span>
	<span class="n">LastName</span>  <span class="kt">string</span>   <span class="err">`</span><span class="n">json</span><span class="p">:</span><span class="s">"lastName"</span><span class="err">`</span>
	<span class="n">Roles</span>     <span class="p">[]</span><span class="kt">string</span> <span class="err">`</span><span class="n">json</span><span class="p">:</span><span class="s">"roles"</span><span class="err">`</span>
<span class="p">}</span>

<span class="n">type</span> <span class="n">AppConnectUsersLinks</span> <span class="p">=</span> <span class="k">struct</span> <span class="err">{</span>
	<span class="nc">Self</span> <span class="kt">string</span> <span class="err">`</span><span class="n">json</span><span class="p">:</span><span class="s">"self"</span><span class="err">`</span>
	<span class="n">Next</span> <span class="kt">string</span> <span class="err">`</span><span class="n">json</span><span class="p">:</span><span class="s">"next"</span><span class="err">`</span>
<span class="p">}</span>

<span class="n">type</span> <span class="n">AppConnectErrors</span> <span class="k">struct</span> <span class="err">{</span>
	<span class="nc">Errors</span> <span class="p">[]</span><span class="k">struct</span> <span class="err">{</span>
		<span class="nc">Status</span> <span class="kt">string</span> <span class="err">`</span><span class="n">json</span><span class="p">:</span><span class="s">"status"</span><span class="err">`</span>
		<span class="n">Code</span>   <span class="kt">string</span> <span class="err">`</span><span class="n">json</span><span class="p">:</span><span class="s">"code"</span><span class="err">`</span>
		<span class="n">Title</span>  <span class="kt">string</span> <span class="err">`</span><span class="n">json</span><span class="p">:</span><span class="s">"title"</span><span class="err">`</span>
		<span class="n">Detail</span> <span class="kt">string</span> <span class="err">`</span><span class="n">json</span><span class="p">:</span><span class="s">"detail"</span><span class="err">`</span>
	<span class="p">}</span> <span class="err">`</span><span class="n">json</span><span class="p">:</span><span class="s">"errors"</span><span class="err">`</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></figure>

<p>The AppConnectUsers, Datum, Attributes, and AppConnectUsersLinks structs define the JSON data that is returned by the List Users API call. If you look back at <a href="/2021/07/09/how-to-access-apples-app-connect-api-from-c-python-and-go-part-1/">Part 1</a>, the JSON document returned by List Users has a lot more in it. We only need to define structs to use the data members that we actually care about. Since this is a read only API call, we can let Unmarshall deserialize only the fields that we will use and it will discard the rest.</p>

<p>We have a second object called AppConnectErrors, with a very different structure. If the API call fails from something happening on Apple’s end, the API will send back a very different JSON document. The following is an example of the JSON that Apple sends back when the API is not available:</p>

<figure class="highlight"><pre><code class="language-jscript" data-lang="jscript"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="code"><pre>{
	"errors": [{
		"status": "500",
		"code": "UNEXPECTED_ERROR",
		"title": "An unexpected error occurred.",
		"detail": "An unexpected error occurred on the server side. If this issue continues, contact us at https://developer.apple.com/contact/."
	}]
}
</pre></td></tr></tbody></table></code></pre></figure>

<p>We’ll cover how to handle that error data later on. The CheckUserList method has a lot going on so we’ll do this in parts.</p>

<figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="code"><pre><span class="n">func</span> <span class="nf">CheckUserList</span><span class="p">(</span><span class="n">config</span> <span class="p">*</span><span class="n">ConfigSettings</span><span class="p">,</span> <span class="n">Username</span> <span class="kt">string</span><span class="p">)</span> <span class="p">{</span>
	<span class="n">token</span><span class="p">,</span> <span class="n">err</span> <span class="p">:=</span> <span class="nf">CreateAppleJWT</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
	<span class="k">if</span> <span class="n">err</span> <span class="p">!=</span> <span class="n">nil</span> <span class="p">{</span>
		<span class="n">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
	<span class="p">}</span>

	<span class="n">client</span> <span class="p">:=</span> <span class="p">&amp;</span><span class="n">http</span><span class="p">.</span><span class="n">Client</span><span class="p">{}</span>

	<span class="kt">var</span> <span class="n">nextUrl</span> <span class="kt">string</span> <span class="p">=</span> <span class="s">"https://api.appstoreconnect.apple.com/v1/users?limit=100"</span>
</pre></td></tr></tbody></table></code></pre></figure>

<p>The first thing is that we call CreateAppleJWT in AppleJWT.go to create the signed JWT. Now we’ll jump into that.</p>

<figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
</pre></td><td class="code"><pre><span class="n">func</span> <span class="nf">CreateAppleJWT</span><span class="p">(</span><span class="n">settings</span> <span class="p">*</span><span class="n">ConfigSettings</span><span class="p">)</span> <span class="p">(</span><span class="kt">string</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span> <span class="p">{</span>
	<span class="n">bytes</span><span class="p">,</span> <span class="n">err</span> <span class="p">:=</span> <span class="n">ioutil</span><span class="p">.</span><span class="nf">ReadFile</span><span class="p">(</span><span class="n">settings</span><span class="p">.</span><span class="n">PrivateKeyFile</span><span class="p">)</span>

	<span class="k">if</span> <span class="n">err</span> <span class="p">!=</span> <span class="n">nil</span> <span class="p">{</span>
		<span class="n">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
	<span class="p">}</span>

	<span class="n">x509Encoded</span><span class="p">,</span> <span class="n">_</span> <span class="p">:=</span> <span class="n">pem</span><span class="p">.</span><span class="nf">Decode</span><span class="p">(</span><span class="n">bytes</span><span class="p">)</span>

	<span class="n">parsedKey</span><span class="p">,</span> <span class="n">err</span> <span class="p">:=</span> <span class="n">x509</span><span class="p">.</span><span class="nf">ParsePKCS8PrivateKey</span><span class="p">(</span><span class="n">x509Encoded</span><span class="p">.</span><span class="n">Bytes</span><span class="p">)</span>

	<span class="k">if</span> <span class="n">err</span> <span class="p">!=</span> <span class="n">nil</span> <span class="p">{</span>
		<span class="n">log</span><span class="p">.</span><span class="nf">Fatal</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
	<span class="p">}</span>

	<span class="n">ecdsaPrivateKey</span><span class="p">,</span> <span class="n">ok</span> <span class="p">:=</span> <span class="n">parsedKey</span><span class="p">.(*</span><span class="n">ecdsa</span><span class="p">.</span><span class="n">PrivateKey</span><span class="p">)</span>

	<span class="k">if</span> <span class="p">!</span><span class="n">ok</span> <span class="p">{</span>
		<span class="nf">panic</span><span class="p">(</span><span class="s">"not ecdsa private key"</span><span class="p">)</span>
	<span class="p">}</span>

	<span class="n">token</span> <span class="p">:=</span> <span class="n">jwt</span><span class="p">.</span><span class="nf">NewWithClaims</span><span class="p">(</span><span class="n">jwt</span><span class="p">.</span><span class="n">SigningMethodES256</span><span class="p">,</span> <span class="n">jwt</span><span class="p">.</span><span class="n">MapClaims</span><span class="p">{</span>
		<span class="s">"iss"</span><span class="p">:</span> <span class="n">settings</span><span class="p">.</span><span class="n">IssuerID</span><span class="p">,</span>
		<span class="s">"exp"</span><span class="p">:</span> <span class="n">time</span><span class="p">.</span><span class="nf">Now</span><span class="p">().</span><span class="nf">Add</span><span class="p">(</span><span class="n">time</span><span class="p">.</span><span class="n">Minute</span> <span class="p">*</span> <span class="m">20</span><span class="p">).</span><span class="nf">Unix</span><span class="p">(),</span>
		<span class="s">"aud"</span><span class="p">:</span> <span class="s">"appstoreconnect-v1"</span><span class="p">,</span>
	<span class="p">})</span>

	<span class="n">token</span><span class="p">.</span><span class="n">Header</span><span class="p">[</span><span class="s">"kid"</span><span class="p">]</span> <span class="p">=</span> <span class="n">settings</span><span class="p">.</span><span class="n">KeyID</span>

	<span class="n">tokenString</span><span class="p">,</span> <span class="n">err</span> <span class="p">:=</span> <span class="n">token</span><span class="p">.</span><span class="nf">SignedString</span><span class="p">(</span><span class="n">ecdsaPrivateKey</span><span class="p">)</span>

	<span class="k">if</span> <span class="n">err</span> <span class="p">!=</span> <span class="n">nil</span> <span class="p">{</span>
		<span class="n">log</span><span class="p">.</span><span class="nf">Fatal</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="n">tokenString</span><span class="p">,</span> <span class="n">nil</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></figure>

<p>At line 2, we read the private key file. Lines 8 through 16 parse the PEM data and come out with the private key in a format that we can use for signing. At line 22, we create the token with an expiration timestamp of <a href="https://tenor.com/view/random-weird-reaction-max-headroom-gif-13720275">20 minutes into the future</a>. We set the token header kid field to our KeyID. We sign the token at line 30 with our private key and pass it back. Getting the token signed correctly was the hardest part of writing this code. Getting back to CheckUserList…</p>

<figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
</pre></td><td class="code"><pre><span class="n">client</span> <span class="p">:=</span> <span class="p">&amp;</span><span class="n">http</span><span class="p">.</span><span class="n">Client</span><span class="p">{}</span>

<span class="kt">var</span> <span class="n">nextUrl</span> <span class="kt">string</span> <span class="p">=</span> <span class="s">"https://api.appstoreconnect.apple.com/v1/users?limit=100"</span>

<span class="kt">var</span> <span class="n">FoundMatch</span> <span class="p">=</span> <span class="k">false</span>

<span class="k">for</span> <span class="p">{</span>
	<span class="n">req</span><span class="p">,</span> <span class="n">err</span> <span class="p">:=</span> <span class="n">http</span><span class="p">.</span><span class="nf">NewRequest</span><span class="p">(</span><span class="s">"GET"</span><span class="p">,</span> <span class="n">nextUrl</span><span class="p">,</span> <span class="n">nil</span><span class="p">)</span>
	<span class="k">if</span> <span class="n">err</span> <span class="p">!=</span> <span class="n">nil</span> <span class="p">{</span>
		<span class="n">fmt</span><span class="p">.</span><span class="nf">Print</span><span class="p">(</span><span class="n">err</span><span class="p">.</span><span class="nf">Error</span><span class="p">())</span>
		<span class="n">os</span><span class="p">.</span><span class="nf">Exit</span><span class="p">(</span><span class="m">3</span><span class="p">)</span>
	<span class="p">}</span>

	<span class="n">req</span><span class="p">.</span><span class="n">Header</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s">"Authorization"</span><span class="p">,</span> <span class="s">"Bearer "</span><span class="p">+</span><span class="n">token</span><span class="p">)</span>

	<span class="n">resp</span><span class="p">,</span> <span class="n">err</span> <span class="p">:=</span> <span class="n">client</span><span class="p">.</span><span class="nf">Do</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
	<span class="k">if</span> <span class="n">err</span> <span class="p">!=</span> <span class="n">nil</span> <span class="p">{</span>
		<span class="n">log</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">"Error on response.\n[ERROR] -"</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>
		<span class="n">os</span><span class="p">.</span><span class="nf">Exit</span><span class="p">(</span><span class="m">3</span><span class="p">)</span>
	<span class="p">}</span>

	<span class="n">defer</span> <span class="n">resp</span><span class="p">.</span><span class="n">Body</span><span class="p">.</span><span class="nf">Close</span><span class="p">()</span>

	<span class="n">body</span><span class="p">,</span> <span class="n">err</span> <span class="p">:=</span> <span class="n">ioutil</span><span class="p">.</span><span class="nf">ReadAll</span><span class="p">(</span><span class="n">resp</span><span class="p">.</span><span class="n">Body</span><span class="p">)</span>
	<span class="k">if</span> <span class="n">err</span> <span class="p">!=</span> <span class="n">nil</span> <span class="p">{</span>
		<span class="n">log</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">"Error while reading the response bytes:"</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>
		<span class="n">os</span><span class="p">.</span><span class="nf">Exit</span><span class="p">(</span><span class="m">3</span><span class="p">)</span>
	<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></figure>

<p>We start with a new instance of an <a href="https://pkg.go.dev/net/http#pkg-overview">http</a> Client. We initialize nextUrl with the initial API url. And we set FoundMatch to false. Now we start looping. At line 8, we new up a new request and add our token at line 14. Line 16 is where we call the API and we wait at line 22 to get the response back.</p>

<p>We read the entire body into a byte array at line 24. Now we can start with the parsing. The first thing to do is see if the API returned an error document instead of the list of users.</p>

<figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre></td><td class="code"><pre><span class="kt">var</span> <span class="n">appConnectErrors</span> <span class="n">AppConnectErrors</span>
<span class="n">err</span> <span class="p">=</span> <span class="n">json</span><span class="p">.</span><span class="nf">Unmarshal</span><span class="p">(</span><span class="n">body</span><span class="p">,</span> <span class="p">&amp;</span><span class="n">appConnectErrors</span><span class="p">)</span>
<span class="k">if</span> <span class="n">err</span> <span class="p">!=</span> <span class="n">nil</span> <span class="p">{</span>
	<span class="n">log</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">"Error while deserializing the response bytes:"</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>
	<span class="n">os</span><span class="p">.</span><span class="nf">Exit</span><span class="p">(</span><span class="m">3</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// If there is an error object in the body, print it and exit</span>
<span class="k">if</span> <span class="nf">len</span><span class="p">(</span><span class="n">appConnectErrors</span><span class="p">.</span><span class="n">Errors</span><span class="p">)</span> <span class="p">&gt;</span> <span class="m">0</span> <span class="p">{</span>
	<span class="n">firstError</span> <span class="p">:=</span> <span class="n">appConnectErrors</span><span class="p">.</span><span class="n">Errors</span><span class="p">[</span><span class="m">0</span><span class="p">]</span>
	<span class="n">log</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">"Status:"</span><span class="p">,</span> <span class="n">firstError</span><span class="p">.</span><span class="n">Status</span><span class="p">)</span>
	<span class="n">log</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">"Error accessing API:"</span><span class="p">,</span> <span class="n">firstError</span><span class="p">.</span><span class="n">Detail</span><span class="p">)</span>
	<span class="n">os</span><span class="p">.</span><span class="nf">Exit</span><span class="p">(</span><span class="m">4</span><span class="p">)</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></figure>

<p>We new up an instance the AppConnectError struct as appConnectErrors. Then we unmarshal the body into appConnectErrors. Next we check the length of the Errors array In appConnectErrors. If the API returns users, the Errors object will not be there and the length will be 0.</p>

<p>If the length of Errors is greater than 0, then “<a href="https://tenor.com/4V3j.gif">Houston, we have a problem</a>“. While Errors is an array and could have more than one error, we don’t care about anything after the first error. So we get the first (and probably only) error. Then we log the error status, which will be a numeric code, and the full text message. And then we die with an error code of 4.</p>

<p>Otherwise we keep going…</p>

<figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
</pre></td><td class="code"><pre><span class="kt">var</span> <span class="n">appConnectUsers</span> <span class="n">AppConnectUsers</span>

<span class="n">err</span> <span class="p">=</span> <span class="n">json</span><span class="p">.</span><span class="nf">Unmarshal</span><span class="p">(</span><span class="n">body</span><span class="p">,</span> <span class="p">&amp;</span><span class="n">appConnectUsers</span><span class="p">)</span>
<span class="k">if</span> <span class="n">err</span> <span class="p">!=</span> <span class="n">nil</span> <span class="p">{</span>
	<span class="n">log</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">"Error while deserializing the response bytes:"</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>
	<span class="n">os</span><span class="p">.</span><span class="nf">Exit</span><span class="p">(</span><span class="m">3</span><span class="p">)</span>
<span class="p">}</span>

<span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">s</span> <span class="p">:=</span> <span class="n">range</span> <span class="n">appConnectUsers</span><span class="p">.</span><span class="n">Data</span> <span class="p">{</span>
	<span class="n">FoundMatch</span> <span class="p">=</span> <span class="n">strings</span><span class="p">.</span><span class="nf">EqualFold</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">Attributes</span><span class="p">.</span><span class="n">Username</span><span class="p">,</span> <span class="n">Username</span><span class="p">)</span>

	<span class="k">if</span> <span class="n">FoundMatch</span> <span class="p">{</span>
		<span class="n">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">"Found %s, %s %s, %s\n"</span><span class="p">,</span>
			<span class="n">s</span><span class="p">.</span><span class="n">Attributes</span><span class="p">.</span><span class="n">Username</span><span class="p">,</span>
			<span class="n">s</span><span class="p">.</span><span class="n">Attributes</span><span class="p">.</span><span class="n">FirstName</span><span class="p">,</span>
			<span class="n">s</span><span class="p">.</span><span class="n">Attributes</span><span class="p">.</span><span class="n">LastName</span><span class="p">,</span>
			<span class="n">strings</span><span class="p">.</span><span class="nf">Join</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">Attributes</span><span class="p">.</span><span class="n">Roles</span><span class="p">,</span> <span class="s">", "</span><span class="p">))</span>
		<span class="k">break</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">if</span> <span class="n">FoundMatch</span> <span class="p">{</span>
	<span class="k">break</span>
<span class="p">}</span>

<span class="n">nextUrl</span> <span class="p">=</span> <span class="n">appConnectUsers</span><span class="p">.</span><span class="n">Links</span><span class="p">.</span><span class="n">Next</span>

<span class="k">if</span> <span class="nf">len</span><span class="p">(</span><span class="n">nextUrl</span><span class="p">)</span> <span class="p">==</span> <span class="m">0</span> <span class="p">{</span>
	<span class="k">break</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></figure>

<p>As with the error struct, we new up a AppConnectUsers struct named appConnectUsers. We unmarshal the JSON data into the struct. At line 9, we iterate through the list of users stored in the Data array. We set FoundMatch at line 10 to true if the username matches. If we have a match, we print that match to the console and use break to exit the for..range loop</p>

<p>Next we break out of the forever loop if we have a match. Otherwise we check to see if we have a next link. If we do, we keep looping, otherwise we are done looping. And we end with an message if we didn’t have a match.</p>

<p>If you cloned the code from the repo and created your own config file (refer back to <a href="/2021/07/09/how-to-access-apples-app-connect-api-from-c-python-and-go-part-1/">Part 1</a> for that part), you can now compile and run the code. You would compile the applet from your terminal of choice with the following command:</p>

<figure class="highlight"><pre><code class="language-plain" data-lang="plain">go build .</code></pre></figure>

<p>If you want the smallest executable, build it with the following options:</p>

<figure class="highlight"><pre><code class="language-plain" data-lang="plain">go build -ldflags="-s -w" .</code></pre></figure>

<p>And then you can compress the resulting executable with a tool like <a href="https://upx.github.io/">upx</a>. You would need to run IsUserInApple with a required command line parameter, the email to look for. If you leave it out, you will get an error message telling you what is needed. Remember that the IsUserInApple.json file needs to be in the same folder as the executable if you don’t use the second optional command line parameter that will let you specify the name of the config file.</p>

<p>If you are running it with the go command, you would run it as</p>

<figure class="highlight"><pre><code class="language-plain" data-lang="plain">go run . -username "some.email@company.com"</code></pre></figure>

<p>or</p>

<figure class="highlight"><pre><code class="language-plain" data-lang="plain">go run . -username "some.email@company.com" -config "IsUserInApple.json"</code></pre></figure>

<p>If you are running it as the compiled executable, you would run it as</p>

<figure class="highlight"><pre><code class="language-plain" data-lang="plain">IsUserInApple -username "some.email@company.com</code></pre></figure>

<p>You’ll back something like this:</p>

<figure class="highlight"><pre><code class="language-plain" data-lang="plain">Looking for some.email@company.com
Found some.email@company.com, Some Email, APP_MANAGER</code></pre></figure>

<p>or….</p>

<figure class="highlight"><pre><code class="language-plain" data-lang="plain">Looking for some.email@company.com
No match for some.email@company.com</code></pre></figure>

<p>On the rare situation that the API is not available and Apple returns an error document, you’ll see something like this:</p>

<figure class="highlight"><pre><code class="language-plain" data-lang="plain"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="code"><pre>Looking for some.email@company.com
2021/07/13 23:26:19 Status: 500
2021/07/13 23:26:19 Error accessing API: An unexpected error occurred on the server side. If this issue continues, contact us at https://developer.apple.com/contact/.
exit status 4
</pre></td></tr></tbody></table></code></pre></figure>

<p>If you run it without  the -username parameter or pass is “-h” or “–help”, you will get back the usuage help messages</p>

<figure class="highlight"><pre><code class="language-plain" data-lang="plain"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td><td class="code"><pre>go run .                                                                
Please specify an email address to match (in quotes)
  -config string
        Configuration file (default "./IsUserInApple.json")
  -username string
        Username to find (in quotes)

go run . -h
Usage of C:\Users\anoth\AppData\Local\Temp\go-build2936985627\b001\exe\IsUserInApple.exe:
  -config string
        Configuration file (default "./IsUserInApple.json")
  -username string
        Username to find (in quotes)
</pre></td></tr></tbody></table></code></pre></figure>

<p>That wraps up this series. You can do more than get the team list from the <a href="https://developer.apple.com/documentation/appstoreconnectapi">App Connect API</a>. For example, if you want to track how many devices have been provisioned, there is a Devices API. Lots of access points for DevOps functionality.</p>

        
      </section>

      <footer class="page__meta">
        
        
  


  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong>
    <span itemprop="keywords">
    
      <a href="/tags/#apple" class="page__taxonomy-item p-category" rel="tag">Apple</a><span class="sep">, </span>
    
      <a href="/tags/#c" class="page__taxonomy-item p-category" rel="tag">C#</a><span class="sep">, </span>
    
      <a href="/tags/#go" class="page__taxonomy-item p-category" rel="tag">Go</a><span class="sep">, </span>
    
      <a href="/tags/#python" class="page__taxonomy-item p-category" rel="tag">Python</a>
    
    </span>
  </p>




  


  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-folder-open" aria-hidden="true"></i> Categories: </strong>
    <span itemprop="keywords">
    
      <a href="/categories/#apple" class="page__taxonomy-item p-category" rel="tag">Apple</a>
    
    </span>
  </p>


        

  <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time class="dt-published" datetime="2021-07-19T13:28:15+00:00">July 19, 2021</time></p>

      </footer>

      <section class="page__share">
  

  <a href="https://twitter.com/intent/tweet?via=anotherlab&text=How+to+access+Apple%27s+App+Connect+API+from+C%23%2C+Python%2C+and+Go.+-+Part+3%20http%3A%2F%2Flocalhost%3A4000%2F2021%2F07%2F19%2Fhow-to-access-apples-app-connect-api-from-c-python-and-go-part-3%2F" class="btn btn--twitter" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Twitter"><i class="fab fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Flocalhost%3A4000%2F2021%2F07%2F19%2Fhow-to-access-apples-app-connect-api-from-c-python-and-go-part-3%2F" class="btn btn--facebook" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Facebook"><i class="fab fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=http://localhost:4000/2021/07/19/how-to-access-apples-app-connect-api-from-c-python-and-go-part-3/" class="btn btn--linkedin" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on LinkedIn"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
</section>


      
  <nav class="pagination">
    
      <a href="/2021/07/12/how-to-access-apples-app-connect-api-from-c-python-and-go-part-2/" class="pagination--pager" title="How to access Apple’s App Connect API from C#, Python, and Go. - Part 2
">Previous</a>
    
    
      <a href="/2021/07/28/a-quick-powershell-tip/" class="pagination--pager" title="A quick PowerShell tip
">Next</a>
    
  </nav>

    </div>

    
  </article>

  
  
    
<div class="page__related">
  
  <h2 class="page__related-title">You May Also Enjoy</h2>
  <div class="grid__wrapper">
    
      
      



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/2025/02/06/bluesky/" rel="permalink">You can find me on Bluesky
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          less than 1 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">

I’ve been on Bluesky for a while now. I still have my account on the dead bird site, but I haven’t posted to it in ages. Not since Musk decided to burn bil...</p>
  </article>
</div>

    
      
      



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/2024/08/27/apples-api-needs-to-be-sorted/" rel="permalink">Apple needs to sort out their API
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          3 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">

I have some code that uses Apple’s AppConnect API to query App store related things. I wrote a C# script that I run from LINQPad that gives me a weekly sta...</p>
  </article>
</div>

    
      
      



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/2023/03/22/android-exported/" rel="permalink">MyFirebaseMessagingService android:exported needs to be explicitly specified
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          1 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">

I needed to make a small change to an Android apop that we have in the Google Play store. I made the change, generated a new apk and we submitted to the ap...</p>
  </article>
</div>

    
      
      



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/2022/09/21/psc-xf5-fundamentals/" rel="permalink">My new Xamarin.Forms 5 Pluralsight course is out
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          less than 1 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">

I have a new course that was just published this week on Pluralsight, “Xamarin.Forms 5 Fundamentals”. It’s seven hours of tutorials and demos for the devel...</p>
  </article>
</div>

    
  </div>
</div>

  
  
</div>

      
    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap"><form class="search-content__form" onkeydown="return event.key != 'Enter';" role="search">
    <label class="sr-only" for="search">
      Enter your search term...
    </label>
    <input type="search" id="search" class="search-input" tabindex="-1" placeholder="Enter your search term..." />
  </form>
  <div id="results" class="results"></div></div>

      </div>
    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    

    
      
        
          <li><a href="https://bsky.app/profile/anotherlab.bsky.social" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-bluesky" aria-hidden="true"></i> Bluesky</a></li>
        
      
        
          <li><a href="https://github.com/anotherlab" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
        
      
        
          <li><a href="https://www.linkedin.com/in/christophermiller/" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i> LinkedIn</a></li>
        
      
        
          <li><a href="https://instagram.com/anotherlab" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-instagram" aria-hidden="true"></i> Instagram</a></li>
        
      
        
          <li><a href="https://mvp.microsoft.com/en-us/PublicProfile/5000200" rel="nofollow noopener noreferrer"><i class="fas fa-fw fa-award" aria-hidden="true"></i> Microsoft MVP</a></li>
        
      
    

    
      <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
    
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2025 <a href="http://localhost:4000">Chris Miller's 5th Blog</a>. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>




<script src="/assets/js/lunr/lunr.min.js"></script>
<script src="/assets/js/lunr/lunr-store.js"></script>
<script src="/assets/js/lunr/lunr-en.js"></script>




    <script>
  'use strict';

  (function () {
    var commentContainer = document.querySelector('#giscus-comments');

    if (!commentContainer) {
      return;
    }

    var script = document.createElement('script');

    script.setAttribute('src', 'https://giscus.app/client.js');
    script.setAttribute('data-repo', 'anotherlab/anotherlab.github.io');
    script.setAttribute('data-repo-id', '');
    script.setAttribute('data-category', '');
    script.setAttribute('data-category-id', '');
    script.setAttribute('data-mapping', 'pathname');
    script.setAttribute('data-strict', '0');
    script.setAttribute('data-reactions-enabled', '1');
    script.setAttribute('data-emit-metadata', '0');
    script.setAttribute('data-input-position', 'top');
    script.setAttribute('data-theme', 'light');
    script.setAttribute('data-lang',  'en');
    
    script.setAttribute('crossorigin', 'anonymous');

    script.setAttribute('async', '');

    commentContainer.appendChild(script);
  })();
</script>

  




  </body>
</html>
