<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Paged recordsets from SQL Server for web pages | Chris Miller’s 4th Blog</title>
<meta name="generator" content="Jekyll v4.2.1" />
<meta property="og:title" content="Paged recordsets from SQL Server for web pages" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="I’ve worked on a few web apps where I displayed a paged list of data, but without storing all of the rows in the view state or as a session variable. I prefer to let SQL Server do the heavy lifting for these kinds of situations. What I want to do is to get a set of filtered data from SQL Server (2000 or better, my friend) with arbitrary row numbers assigned so that I can ask for all rows between X and Y." />
<meta property="og:description" content="I’ve worked on a few web apps where I displayed a paged list of data, but without storing all of the rows in the view state or as a session variable. I prefer to let SQL Server do the heavy lifting for these kinds of situations. What I want to do is to get a set of filtered data from SQL Server (2000 or better, my friend) with arbitrary row numbers assigned so that I can ask for all rows between X and Y." />
<link rel="canonical" href="http://localhost:4000/2006/01/04/paged-recordsets-from-sql-server-for/" />
<meta property="og:url" content="http://localhost:4000/2006/01/04/paged-recordsets-from-sql-server-for/" />
<meta property="og:site_name" content="Chris Miller’s 4th Blog" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2006-01-04T21:15:00-05:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Paged recordsets from SQL Server for web pages" />
<script type="application/ld+json">
{"datePublished":"2006-01-04T21:15:00-05:00","@type":"BlogPosting","url":"http://localhost:4000/2006/01/04/paged-recordsets-from-sql-server-for/","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/2006/01/04/paged-recordsets-from-sql-server-for/"},"dateModified":"2006-01-04T21:15:00-05:00","description":"I’ve worked on a few web apps where I displayed a paged list of data, but without storing all of the rows in the view state or as a session variable. I prefer to let SQL Server do the heavy lifting for these kinds of situations. What I want to do is to get a set of filtered data from SQL Server (2000 or better, my friend) with arbitrary row numbers assigned so that I can ask for all rows between X and Y.","headline":"Paged recordsets from SQL Server for web pages","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="Chris Miller's 4th Blog" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">Chris Miller&#39;s 4th Blog</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">About</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Paged recordsets from SQL Server for web pages</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2006-01-04T21:15:00-05:00" itemprop="datePublished">Jan 4, 2006
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p>I’ve worked on a few web apps where I displayed a paged list of data, but without storing all of the rows in the view state or as a session variable. I prefer to let SQL Server do the <a href="http://heavylifting.blogspot.com/" title="this link has nothing to do with the subject matter">heavy lifting</a> for these kinds of situations. What I want to do is to get a set of filtered data from SQL Server (2000 or better, my friend) with arbitrary row numbers assigned so that I can ask for all rows between X and Y.</p>

<p>There are a few ways to do this, one way I like to do it is with a stored procedure that generates the data and sends back only what I need. This eliminates most of the storage requirements on the web side of things. Using a sample table, I’ll write a procedure that lets me grab the data by row numbers.</p>

<p>create table Employee (<br />
  RecordID integer identity(1,1),<br />
  LastName varchar(30),<br />
  FirstName varchar(20),<br />
  IsDriver char(1)<br />
)</p>

<p>Assume about 1000 or so records, with about 50% of them with the IsDriver field set to ‘Y’. Here’s a procedure for getting a set of data with row numbers included.</p>

<p>CREATE procedure QueryByRow<br />
  @LastName varchar(20),<br />
  @StartRecord int,<br />
  @EndRecord int<br />
AS<br />
DECLARE @MatchCount int</p>

<p>SELECT @MatchCount =<br />
(<br />
  SELECT COUNT(RecordID)<br />
  FROM EMPLOYEES<br />
  WHERE IsDriver=’Y’ AND LastName LIKE @LastName<br />
)</p>

<p>DECLARE @tmp TABLE(ID int identity(1,1), RecordID int, LastName varchar(20), FirstName varchar(20))</p>

<p>SET NOCOUNT ON</p>

<p>INSERT @tmp(RecordID, LastName, FirstName)<br />
SELECT RecordID, LastName, FirstName<br />
FROM EMPLOYEES<br />
WHERE IsDriver=’Y’ AND LastName LIKE @LastName<br />
ORDER BY LastName, FirstName</p>

<p>SET NOCOUNT OFF</p>

<p>SELECT @MatchCount AS Count, t.RecordID, t.LastName, t.FirstName<br />
FROM @tmp t<br />
WHERE t.ID BETWEEN @StartRecord AND @EndRecord</p>

<p>This procedure only allows us to filter by last name, but it can be easily extended to do other filtering or even change the sort order. You would start off by calling the procedure with the RecordCount to get your first page by the starting and ending row numbers. You will get back the result set, with the total number of records as the first column. That information you would store as a session variable or in the viewstate. Now that you know the number of records, you can then get any arbitrary set of those records by calling the procedure again, but with different starting and ending row numbers.</p>

<p>EXECUTE QueryByRow ‘%’, 1, 25</p>

<p>Count       RecordID    LastName             FirstName            <br />
———– ———– ——————– ——————–<br />
494         1           Able                John<br />
494         36          Baker               John<br />
494         69          Charles             John<br />
….<br />
494         6           Dexter              John</p>

<p>If you were showing 25 records per page, and you wanted to display page 3, you would do this:</p>

<p>EXECUTE QueryByRow ‘%’, 0, 51, 75</p>

<p>That would return something like this:</p>

<p>Count       RecordID    LastName             FirstName            <br />
———– ———– ——————– ——————–<br />
494         2           Marro                John<br />
494         46          Martinez             John<br />
494         79          Mitchell             John<br />
….<br />
494         16          Schwede              John</p>

<p>This would bring back just the 25 rows that you would need. There is, of course, <a href="http://www.columbusdirect.com/travel/plan-for-unexpected/no-free-lunch.htm" title="Yet another link having nothing to do with the subject matter.">no free lunch</a>. The drawback is that you are executing the same query against the data every time you call this procedure. You have to weigh the performance of that versus the performance of retrieving a full set of data from the SQL Server to the web server and having the web server filter and persist the data. Depending on your data and the load on your server, SQL Server will have the result set cached in memory and each additional call the procedure will be running against data already in memory.</p>

<p>The use of a <a href="http://support.microsoft.com/default.aspx?scid=kb;en-us;305977" title="To the Knowledge Base!">table variable</a> allows to build the set in memory and create the row numbers. I have seen other examples that used temporary tables and self joins on the table, but table variables seem to place the least demand on the sever resources. This method will work with both SQL Server 2000 and 2005 and is not dependant on any version of ASP.Net.</p>

<p>The other drawback is that other processes could be editing the table between calls to the procedure. This is why the “Count” field is returned with each row. Should that value change between calls to the procedure then you know the data was edited in some way and you would have to make sure that your code could display a different number of records than it expected.</p>

  </div><a class="u-url" href="/2006/01/04/paged-recordsets-from-sql-server-for/" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Chris Miller&#39;s 4th Blog</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Chris Miller&#39;s 4th Blog</li><li><a class="u-email" href="mailto:your-email@example.com">your-email@example.com</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/anotherlab"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">anotherlab</span></a></li><li><a href="https://www.twitter.com/anotherlab"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">anotherlab</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>Write an awesome description for your new site here. You can edit this line in _config.yml. It will appear in your document head meta (for Google search results) and in your feed.xml site description.</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
