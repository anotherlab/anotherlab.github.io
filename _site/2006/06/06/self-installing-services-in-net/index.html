<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Self installing services in .NET | Chris Miller’s 4th Blog</title>
<meta name="generator" content="Jekyll v4.2.1" />
<meta property="og:title" content="Self installing services in .NET" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="I have some service applications that I deploy with Wise for Windows. These particular services are .NET assemblies. The usual way of registering the .NET assembly as a service is to use the installutil.exe that comes with the .NET Framework. Wise made it easy to register the assemblies by adding a checkbox in the file properties for self installation. Behind the scenes, Wise must be calling installutil, because it fails when you have multiple versions of the .NET Framework installed. Installutil is not compatible across Frameworks. You can’t install a 1.1 assembly with the 2.0 installutil, and vice versa." />
<meta property="og:description" content="I have some service applications that I deploy with Wise for Windows. These particular services are .NET assemblies. The usual way of registering the .NET assembly as a service is to use the installutil.exe that comes with the .NET Framework. Wise made it easy to register the assemblies by adding a checkbox in the file properties for self installation. Behind the scenes, Wise must be calling installutil, because it fails when you have multiple versions of the .NET Framework installed. Installutil is not compatible across Frameworks. You can’t install a 1.1 assembly with the 2.0 installutil, and vice versa." />
<link rel="canonical" href="http://localhost:4000/2006/06/06/self-installing-services-in-net/" />
<meta property="og:url" content="http://localhost:4000/2006/06/06/self-installing-services-in-net/" />
<meta property="og:site_name" content="Chris Miller’s 4th Blog" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2006-06-06T22:01:00-04:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Self installing services in .NET" />
<script type="application/ld+json">
{"datePublished":"2006-06-06T22:01:00-04:00","@type":"BlogPosting","url":"http://localhost:4000/2006/06/06/self-installing-services-in-net/","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/2006/06/06/self-installing-services-in-net/"},"dateModified":"2006-06-06T22:01:00-04:00","description":"I have some service applications that I deploy with Wise for Windows. These particular services are .NET assemblies. The usual way of registering the .NET assembly as a service is to use the installutil.exe that comes with the .NET Framework. Wise made it easy to register the assemblies by adding a checkbox in the file properties for self installation. Behind the scenes, Wise must be calling installutil, because it fails when you have multiple versions of the .NET Framework installed. Installutil is not compatible across Frameworks. You can’t install a 1.1 assembly with the 2.0 installutil, and vice versa.","headline":"Self installing services in .NET","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="Chris Miller's 4th Blog" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">Chris Miller&#39;s 4th Blog</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">About</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Self installing services in .NET</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2006-06-06T22:01:00-04:00" itemprop="datePublished">Jun 6, 2006
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p>I have some service applications that I deploy with <a href="http://www.wise.com/wfwi.asp">Wise for Windows</a>. These particular services are .NET <a href="http://www.codeguru.com/columns/csharp_learning/article.php/c5845/">assemblies</a>. The usual way of registering the .NET assembly as a service is to use the <a href="http://msdn2.microsoft.com/en-us/library/50614e95.aspx">installutil.exe</a> that comes with the .NET Framework. Wise made it easy to register the assemblies by adding a checkbox in the file properties for self installation. Behind the scenes, Wise must be calling installutil, because it fails when you have multiple versions of the .NET Framework installed. Installutil is not compatible across Frameworks. You can’t install a 1.1 assembly with the 2.0 installutil, and vice versa.</p>

<p>Wise does not let you specify which version of the Framework is being used by a particuliar assembly. It should be able to tell through Reflection, but it doesn’t. This means I can’t specify the correct installutil to use for my services. This is not good and causes my install projects to go down in <a href="http://www.suburbanchicagonews.com/photos/nascar/labonte/images/t400_seq_1.jpg">flames</a>. I really can’t wait for Wise to fix this.</p>

<p>I could call installutil directly, but that means putting all sorts of <a href="http://www.urbandictionary.com/define.php?term=fugly">fugly</a> code into the install project to correctly locate the appropriate version of installutil. And that code would probably break the minute Microsoft updates the .NET Framework. So we move to Plan B, self-installing services. You would think that this would be a simple walk through the MSDN garden, but their code examples assume that that task is being handled manually via installutil or through a Windows Installer project.</p>

<p>After a bit of Googling, I found a reference to an <a href="http://www.flickr.com/photos/raffaella/101466262/">undocumented</a> method call, <a href="http://msdn2.microsoft.com/en-US/library/system.configuration.install.managedinstallerclass.installhelper.aspx">InstallHelper</a>, in the <a href="http://msdn2.microsoft.com/en-US/library/system.configuration.install.managedinstallerclass.aspx">System.Configuration.Install.ManagedInstallerClass</a> class. By using this method, I can install or uninstall the service from the command line.</p>

<p>I augmented the Main() function in the service class to look like this:</p>

<div>
  <p>
    <span>static</span> <span>void</span> Main(<span>string</span>[] args)
  </p>
  
  <p>
    {
  </p>
  
  <p>
    <span>if</span> (args.Length &gt; 0)
  </p>
  
  <p>
    {
  </p>
  
  <p>
    <span>if</span> (args[0] == <span>&#8220;/i&#8221;</span>)
  </p>
  
  <p>
    {
  </p>
  
  <p>
    System.Configuration.Install.<span>ManagedInstallerClass</span>.InstallHelper(<span>new</span> <span>string</span>[] { <span>Assembly</span>.GetExecutingAssembly().Location });
  </p>
  
  <p>
    }
  </p>
  
  <p>
    <span>else</span> <span>if</span> (args[0] == <span>&#8220;/u&#8221;</span>)
  </p>
  
  <p>
    {
  </p>
  
  <p>
    System.Configuration.Install.<span>ManagedInstallerClass</span>.InstallHelper(<span>new</span> <span>string</span>[] { <span>&#8220;/u&#8221;</span>, <span>Assembly</span>.GetExecutingAssembly().Location });
  </p>
  
  <p>
    }
  </p>
  
  <p>
    <span>else</span> <span>if</span> (args[0] == <span>&#8220;/d&#8221;</span>)
  </p>
  
  <p>
    {
  </p>
  
  <p>
    <span>CollectorService</span> MyService = <span>new</span> <span>CollectorService</span>();
  </p>
  
  <p>
    MyService.OnStart(<span>null</span>);
  </p>
  
  <p>
    System.Threading.<span>Thread</span>.Sleep(System.Threading.<span>Timeout</span>.Infinite);
  </p>
  
  <p>
    }
  </p>
  
  <p>
    }
  </p>
  
  <p>
    <span>else</span>
  </p>
  
  <p>
    {
  </p>
  
  <p>
    System.ServiceProcess.<span>ServiceBase</span>[] ServicesToRun;
  </p>&lt;/p&gt; 
  
  <p>
    ServicesToRun = <span>new</span> System.ServiceProcess.<span>ServiceBase</span>[] { <span>new</span> <span>CollectorService</span>() };
  </p>&lt;/p&gt; 
  
  <p>
    System.ServiceProcess.<span>ServiceBase</span>.Run(ServicesToRun);
  </p>
  
  <p>
    }
  </p>
  
  <p>
    }
  </p>
</div>

<p>The “/d” part hasn’t been tested yet. That should allow me to debug the service as an application from within the Visual Studio IDE. As much as I dislike having to use an undocumented class, I’m not going to lose any sleep over it. Microsoft obsoleted documented functions going from Visual Studio 2003 to 2005, I’m not going to worry about one method.</p>

<p>[Edited on 6/8/06]<br />
I updated the block of code for the “/d” part. I needed a timeout to keep the service running, otherwise it just runs through the startup and then exits. You can make it fancier, I just use that code for testing from within the IDE and I can break out of the service when I am done testing it.</p>

<p>[Edited on 7/20/06]<br />
After a few go arounds with Wise Technical Support, I sent them a sample installer project that easily duplicate this bug and they did confirm that it was a problem with their current product. There is also a similiar problem where you can’t install .NET 1.1 services under similiar circumstances. Their fix for my problem will fix the .NET 1.1 service problem too. According to the email that I had received, this is tentatively scheduled for the next release. That would probably be the version 7.0 release. In the meantime, I’ll stick with my work around.</p>

<p>[Edited on 1/27/08]<br />
The MyService object in the above code is an instance of a System.ServiceProcess.ServiceBase descendant class that I created in my code.  The descendant class opens up access to the protecteded OnStart() method.  I had created a descendant to ServiceBase and had assumed that was the standard pattern.  I should have been more clear about that part.  This is one of the many reasons why I abandoned Wise for InstallAware.</p>

<div>
  Tech Tags: <a href="http://technorati.com/tag/Wise+For+Windows" rel="tag">Wise For Windows</a> <a href="http://technorati.com/tag/InstallUtil.exe" rel="tag">InstallUtil.exe</a> <a href="http://technorati.com/tag/InstallHelper" rel="tag">InstallHelper</a> <a href="http://technorati.com/tag/ManagedInstallerClass" rel="tag">ManagedInstallerClass</a> <a href="http://technorati.com/tag/C#" rel="tag">C#</a> <a href="http://technorati.com/tag/Visual+Studio+2005" rel="tag">Visual Studio 2005</a>
</div>

  </div><a class="u-url" href="/2006/06/06/self-installing-services-in-net/" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Chris Miller&#39;s 4th Blog</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Chris Miller&#39;s 4th Blog</li><li><a class="u-email" href="mailto:your-email@example.com">your-email@example.com</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/anotherlab"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">anotherlab</span></a></li><li><a href="https://www.twitter.com/anotherlab"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">anotherlab</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>Write an awesome description for your new site here. You can edit this line in _config.yml. It will appear in your document head meta (for Google search results) and in your feed.xml site description.</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
