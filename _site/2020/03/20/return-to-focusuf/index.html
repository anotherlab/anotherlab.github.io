<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Return to FocusUF | Chris Miller’s 4th Blog</title>
<meta name="generator" content="Jekyll v4.2.1" />
<meta property="og:title" content="Return to FocusUF" />
<meta name="author" content="Chris Miller" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="A while back, I blogged about a command line hack to set the focus for a web cam.  I was using a Microsoft LifeCam HD-5000 and it has the annoying habit of refocusing if you move around in your seat." />
<meta property="og:description" content="A while back, I blogged about a command line hack to set the focus for a web cam.  I was using a Microsoft LifeCam HD-5000 and it has the annoying habit of refocusing if you move around in your seat." />
<link rel="canonical" href="http://localhost:4000/2020/03/20/return-to-focusuf/" />
<meta property="og:url" content="http://localhost:4000/2020/03/20/return-to-focusuf/" />
<meta property="og:site_name" content="Chris Miller’s 4th Blog" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-03-20T23:49:29-04:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Return to FocusUF" />
<script type="application/ld+json">
{"datePublished":"2020-03-20T23:49:29-04:00","@type":"BlogPosting","url":"http://localhost:4000/2020/03/20/return-to-focusuf/","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/2020/03/20/return-to-focusuf/"},"dateModified":"2020-03-20T23:49:29-04:00","author":{"@type":"Person","name":"Chris Miller"},"description":"A while back, I blogged about a command line hack to set the focus for a web cam.  I was using a Microsoft LifeCam HD-5000 and it has the annoying habit of refocusing if you move around in your seat.","headline":"Return to FocusUF","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="Chris Miller's 4th Blog" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">Chris Miller&#39;s 4th Blog</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">About</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Return to FocusUF</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2020-03-20T23:49:29-04:00" itemprop="datePublished">Mar 20, 2020
      </time>• <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span class="p-author h-card" itemprop="name">Chris Miller</span></span></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p>A while back, I <a href="https://rajapet.com/2018/04/05/focusuf-or-how-to-turn-off-the-autofocus-setting-of-the-lifecam-hd-5000-webcam/">blogged</a> about a command line hack to set the focus for a web cam.  I was using a Microsoft LifeCam HD-5000 and it has the annoying habit of refocusing if you move around in your seat.</p>

<p>It’s two years later and I have had a request for a compiled version of the FocusUF.  It wasn’t much more than a paragraph of code and I put it up on <a href="https://github.com/anotherlab/FocusUF">GitHub</a> for anyone to use.  That’s all I had wanted to do, just the share the code and move on.</p>

<p>It’s not a product, it’s a block of code.  I had resisted putting a compiled version up because it’s not something I wanted to support.  But if you are not a .NET developer, it’s big ask to take that code and make a tiny command line tool.  I get it.  I decided to add a compiled version of the code to the GitHub repository.  For use as is, no support.</p>

<p>I went back to the project and fired it up.  It’s been two years and management has made some changes.  I’m using Visual Studio 2019 and I no longer use that web cam.  I upgraded to a Logitech c922 and no longer use the LifeCam.</p>

<p>The good news is the code compiled with no changes from VS 2019.  Which is what <a href="https://tenor.com/sDps.gif">I expected</a>.  When I ran it, tt crashed and burned with an error.  Which I did <a href="https://tenor.com/Kgay.gif">not expect</a>.  It literally dies on the second line of code.  The first two lines of code look like this:</p>

<div class="wp-block-syntaxhighlighter-code ">
  <pre class="brush: csharp; highlight: [6]; title: ; notranslate" title="">
// Get the list of connected video cameras
DsDevice&#91;] devs = DsDevice.GetDevicesOfCat(FilterCategory.VideoInputDevice);

// Filter that list down to the one with hyper-aggressive focus
var dev = devs
  .Where(d =&gt; d.Name.Equals("Microsoft® LifeCam HD-5000"))
  .FirstOrDefault();

</pre>
</div>

<p>I broke the second line into multiple lines to make this a little easier to follow.  I was getting a null exception on the highlighted line, specifically on d.Name.</p>

<p>For some reason, one of the items in the devs array has null for a name and that broke my code.  It was never a problem before, because the LifeCam was first in the list returned by GetDevicesOfCat.  Since I no longer had that web cam plugged in, the LINQ query was going through the entire list.  And then erroring out trying to call Equals() on a null value. [SPOILER ALERT! That assumption was completely wrong.]</p>

<p>I was curious to see what was null. When I want to quickly visually data structures, I like to use <a href="https://www.linqpad.net/">LINQPad</a>. So I copied and pasted those two lines into LINQPad and pulled in the <a href="https://www.nuget.org/packages/DirectShowLib/">nuget package for DirectShowLib</a>.  I then used the Dump() extension method to look at what was being returned for GetDevicesOfCat.<figure class="wp-block-table is-style-stripes"></figure></p>

<table class="">
  <tr>
    <th>
      DevicePath
    </th>
    
    <th>
      Name
    </th>
  </tr>
  
  <tr>
    <td>
      @device:pnp:\?\usb#vid_046d&amp;pid_085c&amp;mi_00#7&amp;18173bf5&amp;0&amp;0000#{65e8773d-8f56-11d0-a3b9-00a0c9223196}\global
    </td>
    
    <td>
      c922 Pro Stream Webcam
    </td>
  </tr>
  
  <tr>
    <td>
      @device:pnp:\?\root#psycamera#0000#{65e8773d-8f56-11d0-a3b9-00a0c9223196}{9f25a503-ac24-460f-9196-8553ad691ef0}
    </td>
    
    <td>
      null
    </td>
  </tr>
  
  <tr>
    <td>
      @device:sw:{860BB310-5D01-11D0-BD3B-00A0C911CE86}{3403512D-FE5D-4D68-B053-E86D662E4D58}
    </td>
    
    <td>
      ChromaCam
    </td>
  </tr>
</table>
<p>&lt;/figure&gt;</p>

<p>And there’s the null value.  That was odd and we’ll get back that in minute.  In the meantime, let’s fix that code.  Instead of trying to be clever and use the Equals() function, I changed the code to just use the equals operator and let it handle the null check.  That one line becomes:</p>

<div class="wp-block-syntaxhighlighter-code ">
  <pre class="brush: csharp; highlight: [2]; title: ; notranslate" title="">
var dev = devs
  .Where(d =&gt; d.Name == "Microsoft® LifeCam HD-5000")
  .FirstOrDefault();
</pre>
</div>

<p>I compiled the code and ran it.  And it did nothing.  Which is what I expected since I no longer had the LifeCam plugged in.  More importantly, it didn’t throw an error.</p>

<p>I went back and added some Console.Writeln() statements so the app would at least say what it was doing or not doing.  I built it again, zipped up the .dll &amp; .exe files and added the <a href="https://github.com/anotherlab/FocusUF/blob/master/win32/focusuf.zip">zip file</a> to a new win32 folder in the GitHub repository.  So if you don’t have access to Visual Studio, you can grab just that zip file and get the FocusUF.exe app.  But I’m not supporting that app.  If it doesn’t work for you, just grab the code and compile it.</p>

<p>With the repo updated, it’s time to see what is our little null friend. If you look at the DevicePath, it has a wierd name buried in it. What is psycamera? If you google it, you find that a lot of people mispell “spy camera”. So that was no help. Names that are null set off my spidey senses. I wasn’t going to let that one just sit there with a look at it.</p>

<p>Going with the path of least resistance, I fired up Device Manager to see if something looked unfamilair or out of place. Sure enough, under “Cameras”, there was a new item named “Personify Virtual Camera Universal”. The Personify name was vaguely familiar [SPOILER ALERT] and I had a pretty good idea of what was going on, but I decided to double click on it and drill into the details.</p>

<p><a href="https://tenor.com/uMmi.gif">Literally</a> into the details. I selected the Details tab and select Device Instance Path from the drop-down list. That gave us this:<figure class="wp-block-image size-large"></figure></p>

<p><img src="https://i0.wp.com/photos.smugmug.com/Blog/n-zwT5d/2020/i-pF6Z8M7/0/53d4ae95/L/psycamera-L.png?w=680&#038;ssl=1" alt="" data-recalc-dims="1" /> &lt;/figure&gt;</p>

<p>And there is the mystery psycamera. Going back to the LINQPad dump, the third item that the list returned by GetDevicesOfCat was named ChromaCam. <a href="https://www.chromacam.me/">ChromaCam</a> is a virtual webcam. It lets you replace your background with an image. And ChromaCam is made by a company named Personify. I’m not sure exactly what they are doing with the psycamera device, but it’s fairly innocuous. When I wrote the code two years ago, I did not have ChromaCam, so my code back then only had to deal with a single item in the devs list.</p>

<p>I did see if the code would compile with Visual Studio code and I think it would, but not <a href="https://stackoverflow.com/questions/47707095/visual-studio-code-for-net-framework">out of the box</a>. It looks like it would be more trouble than its worth. But I do recommend ChromaCam, it’s fun to play with.</p>

  </div><a class="u-url" href="/2020/03/20/return-to-focusuf/" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Chris Miller&#39;s 4th Blog</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Chris Miller&#39;s 4th Blog</li><li><a class="u-email" href="mailto:your-email@example.com">your-email@example.com</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/anotherlab"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">anotherlab</span></a></li><li><a href="https://www.twitter.com/anotherlab"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">anotherlab</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>Write an awesome description for your new site here. You can edit this line in _config.yml. It will appear in your document head meta (for Google search results) and in your feed.xml site description.</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
