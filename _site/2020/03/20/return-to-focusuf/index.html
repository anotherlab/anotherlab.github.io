<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.24.0 by Michael Rose
  Copyright 2013-2020 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Return to FocusUF - Chris Miller’s 4th Blog</title>
<meta name="description" content="A while back, I blogged about a command line hack to set the focus for a web cam.  I was using a Microsoft LifeCam HD-5000 and it has the annoying habit of refocusing if you move around in your seat.">



<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="Chris Miller's 4th Blog">
<meta property="og:title" content="Return to FocusUF">
<meta property="og:url" content="/2020/03/20/return-to-focusuf/">


  <meta property="og:description" content="A while back, I blogged about a command line hack to set the focus for a web cam.  I was using a Microsoft LifeCam HD-5000 and it has the annoying habit of refocusing if you move around in your seat.">





  <meta name="twitter:site" content="@anotherlab">
  <meta name="twitter:title" content="Return to FocusUF">
  <meta name="twitter:description" content="A while back, I blogged about a command line hack to set the focus for a web cam.  I was using a Microsoft LifeCam HD-5000 and it has the annoying habit of refocusing if you move around in your seat.">
  <meta name="twitter:url" content="/2020/03/20/return-to-focusuf/">

  
    <meta name="twitter:card" content="summary">
    
  

  



  <meta property="article:published_time" content="2020-03-20T23:49:29-04:00">






<link rel="canonical" href="/2020/03/20/return-to-focusuf/">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": "Chris Miller",
      "url": "/"
    
  }
</script>







<!-- end _includes/seo.html -->



  <link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Chris Miller's 4th Blog Feed">


<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css"></noscript>



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--post">
    <nav class="skip-links">
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
        <a class="site-title" href="/">
          Chris Miller's 4th Blog
          
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/posts/">Posts</a>
            </li><li class="masthead__menu-item">
              <a href="/categories/">Categories</a>
            </li><li class="masthead__menu-item">
              <a href="/tags/">Tags</a>
            </li><li class="masthead__menu-item">
              <a href="/about/">About</a>
            </li></ul>
        
        <button class="search__toggle" type="button">
          <span class="visually-hidden">Toggle search</span>
          <i class="fas fa-search"></i>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Return to FocusUF</h1>
    <p class="post-meta"><time class="dt-published" datetime="2020-03-20T23:49:29-04:00" itemprop="datePublished">
        Mar 20, 2020
      </time>• 
          <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <span class="p-author h-card" itemprop="name">Chris Miller</span></span></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p>A while back, I <a href="https://rajapet.com/2018/04/05/focusuf-or-how-to-turn-off-the-autofocus-setting-of-the-lifecam-hd-5000-webcam/">blogged</a> about a command line hack to set the focus for a web cam.  I was using a Microsoft LifeCam HD-5000 and it has the annoying habit of refocusing if you move around in your seat.</p>

<p>It’s two years later and I have had a request for a compiled version of the FocusUF.  It wasn’t much more than a paragraph of code and I put it up on <a href="https://github.com/anotherlab/FocusUF">GitHub</a> for anyone to use.  That’s all I had wanted to do, just the share the code and move on.</p>

<p>It’s not a product, it’s a block of code.  I had resisted putting a compiled version up because it’s not something I wanted to support.  But if you are not a .NET developer, it’s big ask to take that code and make a tiny command line tool.  I get it.  I decided to add a compiled version of the code to the GitHub repository.  For use as is, no support.</p>

<p>I went back to the project and fired it up.  It’s been two years and management has made some changes.  I’m using Visual Studio 2019 and I no longer use that web cam.  I upgraded to a Logitech c922 and no longer use the LifeCam.</p>

<p>The good news is the code compiled with no changes from VS 2019.  Which is what <a href="https://tenor.com/sDps.gif">I expected</a>.  When I ran it, tt crashed and burned with an error.  Which I did <a href="https://tenor.com/Kgay.gif">not expect</a>.  It literally dies on the second line of code.  The first two lines of code look like this:</p>

<div class="wp-block-syntaxhighlighter-code ">
  <pre class="brush: csharp; highlight: [6]; title: ; notranslate" title="">
// Get the list of connected video cameras
DsDevice&#91;] devs = DsDevice.GetDevicesOfCat(FilterCategory.VideoInputDevice);

// Filter that list down to the one with hyper-aggressive focus
var dev = devs
  .Where(d =&gt; d.Name.Equals("Microsoft® LifeCam HD-5000"))
  .FirstOrDefault();

</pre>
</div>

<p>I broke the second line into multiple lines to make this a little easier to follow.  I was getting a null exception on the highlighted line, specifically on d.Name.</p>

<p>For some reason, one of the items in the devs array has null for a name and that broke my code.  It was never a problem before, because the LifeCam was first in the list returned by GetDevicesOfCat.  Since I no longer had that web cam plugged in, the LINQ query was going through the entire list.  And then erroring out trying to call Equals() on a null value. [SPOILER ALERT! That assumption was completely wrong.]</p>

<p>I was curious to see what was null. When I want to quickly visually data structures, I like to use <a href="https://www.linqpad.net/">LINQPad</a>. So I copied and pasted those two lines into LINQPad and pulled in the <a href="https://www.nuget.org/packages/DirectShowLib/">nuget package for DirectShowLib</a>.  I then used the Dump() extension method to look at what was being returned for GetDevicesOfCat.<figure class="wp-block-table is-style-stripes"></figure></p>

<table class="">
  <tr>
    <th>
      DevicePath
    </th>
    
    <th>
      Name
    </th>
  </tr>
  
  <tr>
    <td>
      @device:pnp:\?\usb#vid_046d&amp;pid_085c&amp;mi_00#7&amp;18173bf5&amp;0&amp;0000#{65e8773d-8f56-11d0-a3b9-00a0c9223196}\global
    </td>
    
    <td>
      c922 Pro Stream Webcam
    </td>
  </tr>
  
  <tr>
    <td>
      @device:pnp:\?\root#psycamera#0000#{65e8773d-8f56-11d0-a3b9-00a0c9223196}{9f25a503-ac24-460f-9196-8553ad691ef0}
    </td>
    
    <td>
      null
    </td>
  </tr>
  
  <tr>
    <td>
      @device:sw:{860BB310-5D01-11D0-BD3B-00A0C911CE86}{3403512D-FE5D-4D68-B053-E86D662E4D58}
    </td>
    
    <td>
      ChromaCam
    </td>
  </tr>
</table>
<p>&lt;/figure&gt;</p>

<p>And there’s the null value.  That was odd and we’ll get back that in minute.  In the meantime, let’s fix that code.  Instead of trying to be clever and use the Equals() function, I changed the code to just use the equals operator and let it handle the null check.  That one line becomes:</p>

<div class="wp-block-syntaxhighlighter-code ">
  <pre class="brush: csharp; highlight: [2]; title: ; notranslate" title="">
var dev = devs
  .Where(d =&gt; d.Name == "Microsoft® LifeCam HD-5000")
  .FirstOrDefault();
</pre>
</div>

<p>I compiled the code and ran it.  And it did nothing.  Which is what I expected since I no longer had the LifeCam plugged in.  More importantly, it didn’t throw an error.</p>

<p>I went back and added some Console.Writeln() statements so the app would at least say what it was doing or not doing.  I built it again, zipped up the .dll &amp; .exe files and added the <a href="https://github.com/anotherlab/FocusUF/blob/master/win32/focusuf.zip">zip file</a> to a new win32 folder in the GitHub repository.  So if you don’t have access to Visual Studio, you can grab just that zip file and get the FocusUF.exe app.  But I’m not supporting that app.  If it doesn’t work for you, just grab the code and compile it.</p>

<p>With the repo updated, it’s time to see what is our little null friend. If you look at the DevicePath, it has a wierd name buried in it. What is psycamera? If you google it, you find that a lot of people mispell “spy camera”. So that was no help. Names that are null set off my spidey senses. I wasn’t going to let that one just sit there with a look at it.</p>

<p>Going with the path of least resistance, I fired up Device Manager to see if something looked unfamilair or out of place. Sure enough, under “Cameras”, there was a new item named “Personify Virtual Camera Universal”. The Personify name was vaguely familiar [SPOILER ALERT] and I had a pretty good idea of what was going on, but I decided to double click on it and drill into the details.</p>

<p><a href="https://tenor.com/uMmi.gif">Literally</a> into the details. I selected the Details tab and select Device Instance Path from the drop-down list. That gave us this:<figure class="wp-block-image size-large"></figure></p>

<p><img src="https://i0.wp.com/photos.smugmug.com/Blog/n-zwT5d/2020/i-pF6Z8M7/0/53d4ae95/L/psycamera-L.png?w=680&#038;ssl=1" alt="" data-recalc-dims="1" /> &lt;/figure&gt;</p>

<p>And there is the mystery psycamera. Going back to the LINQPad dump, the third item that the list returned by GetDevicesOfCat was named ChromaCam. <a href="https://www.chromacam.me/">ChromaCam</a> is a virtual webcam. It lets you replace your background with an image. And ChromaCam is made by a company named Personify. I’m not sure exactly what they are doing with the psycamera device, but it’s fairly innocuous. When I wrote the code two years ago, I did not have ChromaCam, so my code back then only had to deal with a single item in the devs list.</p>

<p>I did see if the code would compile with Visual Studio code and I think it would, but not <a href="https://stackoverflow.com/questions/47707095/visual-studio-code-for-net-framework">out of the box</a>. It looks like it would be more trouble than its worth. But I do recommend ChromaCam, it’s fun to play with.</p>

  </div><a class="u-url" href="/2020/03/20/return-to-focusuf/" hidden></a>
</article>

    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap"><form class="search-content__form" onkeydown="return event.key != 'Enter';" role="search">
    <label class="sr-only" for="search">
      Enter your search term...
    </label>
    <input type="search" id="search" class="search-input" tabindex="-1" placeholder="Enter your search term..." />
  </form>
  <div id="results" class="results"></div></div>

      </div>
    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    

    
      
        
          <li><a href="https://twitter.com/anotherlab" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter</a></li>
        
      
        
          <li><a href="https://github.com/anotherlab" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
        
      
        
          <li><a href="https://instagram.com/anotherlab" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-instagram" aria-hidden="true"></i> Instagram</a></li>
        
      
        
          <li><a href="https://mvp.microsoft.com/en-us/PublicProfile/5000200" rel="nofollow noopener noreferrer"><i class="fas fa-fw fa-award" aria-hidden="true"></i> Microsoft MVP</a></li>
        
      
    

    
      <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
    
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2021 Chris Miller. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>




<script src="/assets/js/lunr/lunr.min.js"></script>
<script src="/assets/js/lunr/lunr-store.js"></script>
<script src="/assets/js/lunr/lunr-en.js"></script>




    <script>
  'use strict';

  (function () {
    var commentContainer = document.querySelector('#giscus-comments');

    if (!commentContainer) {
      return;
    }

    var script = document.createElement('script');
    script.setAttribute('src', 'https://giscus.app/client.js');
    script.setAttribute('data-repo', 'anotherlab/anotherlab.github.io');
    script.setAttribute('data-repo-id', '');
    script.setAttribute('data-category', '');
    script.setAttribute('data-category-id', '');
    script.setAttribute('data-mapping', 'pathname');
    script.setAttribute('data-reactions-enabled', '1');
    script.setAttribute('data-theme', 'light');
    script.setAttribute('crossorigin', 'anonymous');

    commentContainer.appendChild(script);
  })();
</script>
  





  </body>
</html>
