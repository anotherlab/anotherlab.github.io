<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Modifying test data for privacy | Chris Miller’s 4th Blog</title>
<meta name="generator" content="Jekyll v4.2.1" />
<meta property="og:title" content="Modifying test data for privacy" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Sometimes I get actual live data from a client to track down a bug that only happens with their data.  That data will contain student records and we don’t like to have live student laying around.   We can use TDE to encrypt the data at rest, but if I’m sharing that data with other developers, I want to scrub identifying details from data set." />
<meta property="og:description" content="Sometimes I get actual live data from a client to track down a bug that only happens with their data.  That data will contain student records and we don’t like to have live student laying around.   We can use TDE to encrypt the data at rest, but if I’m sharing that data with other developers, I want to scrub identifying details from data set." />
<link rel="canonical" href="http://localhost:4000/2016/05/18/modifying-test-data-for-privacy/" />
<meta property="og:url" content="http://localhost:4000/2016/05/18/modifying-test-data-for-privacy/" />
<meta property="og:site_name" content="Chris Miller’s 4th Blog" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2016-05-18T16:08:15-04:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Modifying test data for privacy" />
<script type="application/ld+json">
{"datePublished":"2016-05-18T16:08:15-04:00","@type":"BlogPosting","url":"http://localhost:4000/2016/05/18/modifying-test-data-for-privacy/","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/2016/05/18/modifying-test-data-for-privacy/"},"dateModified":"2016-05-18T16:08:15-04:00","description":"Sometimes I get actual live data from a client to track down a bug that only happens with their data.  That data will contain student records and we don’t like to have live student laying around.   We can use TDE to encrypt the data at rest, but if I’m sharing that data with other developers, I want to scrub identifying details from data set.","headline":"Modifying test data for privacy","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="Chris Miller's 4th Blog" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">Chris Miller&#39;s 4th Blog</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">About</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Modifying test data for privacy</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2016-05-18T16:08:15-04:00" itemprop="datePublished">May 18, 2016
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p>Sometimes I get actual live data from a client to track down a bug that only happens with their data.  That data will contain student records and we don’t like to have live student laying around.   We can use <a href="https://msdn.microsoft.com/en-us/library/bb934049.aspx">TDE</a> to encrypt the data at rest, but if I’m sharing that data with other developers, I want to scrub identifying details from data set.</p>

<p>For the most part, I just need to replace the first and last names from student table.  I could set both the first and last names to “<a href="http://www.ganksoft.com/">Gank</a>“, but if every record looks the same, it can be hard to see how the bug manifests itself.  I could set both attributes to the record id value for the record, but I find that hard to look at after a while.</p>

<p>What I end up is writing some sort of reubenizer code.  The reubenizer changes the first and last names to some variation of “Reuben”.</p>

<div style="width: 160px" class="wp-caption aligncenter">
  <a href="https://en.wikipedia.org/wiki/Dave_Madden"><img loading="lazy" class="" src="https://i0.wp.com/photos.smugmug.com/photos/i-jQWQ4m4/0/Th/i-jQWQ4m4-Th.jpg?resize=150%2C150&#038;ssl=1" width="150" height="150" data-recalc-dims="1" /></a>
  
  <p class="wp-caption-text">
    The Patron Saint of all that is Reuben.  Dave Madden as Reuben Kincaid
  </p>
</div>

<p>Let’s create a fake table to represent the student data to modify.</p>

<pre class="brush:sql">declare @Student TABLE
(
    RecordID varchar(4),
    FirstName varchar(80),
    LastName varchar(80),
    Gender char(1)
);

-- Push in some fake data
insert into @Student (RecordID, FirstName, LastName, Gender) values (1, &#039;Joe&#039;, &#039;Smith&#039;, &#039;M&#039;);
insert into @Student (RecordID, FirstName, LastName, Gender) values (2, &#039;Joel&#039;, &#039;Smith&#039;, &#039;M&#039;);
insert into @Student (RecordID, FirstName, LastName, Gender) values (3, &#039;Jane&#039;, &#039;Smith&#039;, &#039;F&#039;);
insert into @Student (RecordID, FirstName, LastName, Gender) values (4, &#039;Linda&#039;, &#039;Tokken&#039;, &#039;F&#039;);
insert into @Student (RecordID, FirstName, LastName, Gender) values (5, &#039;Samantha&#039;, &#039;Queen&#039;, &#039;F&#039;);
insert into @Student (RecordID, FirstName, LastName, Gender) values (6, &#039;Steve&#039;, &#039;Burton&#039;, &#039;M&#039;);
insert into @Student (RecordID, FirstName, LastName, Gender) values (7, &#039;Doug&#039;, &#039;Francis&#039;, &#039;M&#039;);
insert into @Student (RecordID, FirstName, LastName, Gender) values (8, &#039;Linda&#039;, &#039;McLinda&#039;, &#039;F&#039;);
insert into @Student (RecordID, FirstName, LastName, Gender) values (9, &#039;Paul&#039;, &#039;Davis&#039;, &#039;M&#039;);
insert into @Student (RecordID, FirstName, LastName, Gender) values (10, &#039;Ann&#039;, &#039;Davis&#039;, &#039;F&#039;);
</pre>

<p>Running those statements will generate a result set that looks like this</p>

<pre>RecordID FirstName        LastName         Gender
-------- ---------------- ---------------- ------
1        Joe              Smith            M
2        Joel             Smith            M
3        Jane             Smith            F
4        Linda            Tokken           F
5        Samantha         Queen            F
6        Steve            Burton           M
7        Doug             Francis          M
8        Linda            McLinda          F
9        Paul             Davis            M
10       Ann              Davis            F
</pre>

<p>The first thing I do is create a table with a set of surname prefixes.  These prefixes will be used with the string “Reuben” to create the new last names</p>

<pre class="brush:sql">-- Create a table with some surname prefixes.  
-- We&#039;ll pick the prefix from the last digit of the record id of the student.
-- We only do this so we don&#039;t have to look at the same name for every row

declare @Reuben TABlE
(
    RecordID varchar(4),
    LastName varchar(16)
);

-- Pick 10 different prefixes
insert into @Reuben (RecordID, LastName) values (&#039;1&#039;, &#039;Mc&#039;);
insert into @Reuben (RecordID, LastName) values (&#039;2&#039;, &#039;de &#039;);
insert into @Reuben (RecordID, LastName) values (&#039;3&#039;, &#039;Del&#039;);
insert into @Reuben (RecordID, LastName) values (&#039;4&#039;, &#039;St &#039;);
insert into @Reuben (RecordID, LastName) values (&#039;5&#039;, &#039;Van &#039;);
insert into @Reuben (RecordID, LastName) values (&#039;6&#039;, &#039;Le &#039;);
insert into @Reuben (RecordID, LastName) values (&#039;7&#039;, &#039;La&#039;);
insert into @Reuben (RecordID, LastName) values (&#039;8&#039;, &#039;Lo&#039;);
insert into @Reuben (RecordID, LastName) values (&#039;9&#039;, &#039;O&#039;&#039;&#039;);
insert into @Reuben (RecordID, LastName) values (&#039;0&#039;, &#039;&#039;);
</pre>

<p>Now it’s time to create the update statement to reubenize the names. To get the surname prefix, we’ll get the last digit of the record id. That will slice up the students into 10 different sets of last names. There are other ways of doing this, this one is quick and simple. You could do the same thing with the first name, but in this case, I’m just going to use “Reuben” for the boys and “Reubenette” for the girls, and tack on that last digit.</p>

<p>To make the code a little cleaner, I use a <a href="https://msdn.microsoft.com/en-us/library/ms190766.aspx">Common Table Expression</a> (or CTE) to create a calculated field for the last digit of the record id. If you are not familair with CTE’s, they let you build temporary result sets that only exist within the context of the SQL expression that they are in.  I blogged about using a CTE <a href="http://www.rajapet.com/2016/02/generating-new-row-numbers-in-sql-based-on-a-starting-value.html">here</a> and <a href="http://www.rajapet.com/2010/04/suppressing-repeated-column-value-in.html">there</a>.</p>

<p>That update statement would look something like this</p>

<pre class="brush:sql">-- Using a CTE allows us to calculate the last digit just once
WITH cte (recordid, offset) 
     AS (SELECT recordid, 
                RIGHT(Cast(s.recordid AS VARCHAR), 1) AS OffSet 
         FROM   @student s) 
UPDATE s 
SET    s.lastname = Concat(r.lastname, &#039;Reuben&#039;), 
       s.firstname = CASE s.gender 
                       WHEN &#039;M&#039; THEN Concat(&#039;Reuben-&#039;, cte.recordid) 
                       ELSE Concat(&#039;Reubenette-&#039;, cte.recordid) 
                     END 
FROM   cte 
       JOIN @student s 
         ON cte.recordid = s.recordid 
       JOIN @Reuben r 
         ON r.recordid = cte.offset; 
</pre>

<p>After running that update statement, the result set will look like this</p>

<pre>RecordID FirstName        LastName         Gender
-------- ---------------- ---------------- ------
1        Reuben-1         McReuben         M
2        Reuben-2         de Reuben        M
3        Reubenette-3     DelReuben        F
4        Reubenette-4     St Reuben        F
5        Reubenette-5     Van Reuben       F
6        Reuben-6         Le Reuben        M
7        Reuben-7         LaReuben         M
8        Reubenette-8     LoReuben         F
9        Reuben-9         O&#039;Reuben         M
10       Reubenette-10    Reuben           F
</pre>

<p>The records are no longer recognizable and are distinct enough to allow me to debug the problem. This doesn’t work for every kind of data element, but it allows me to work with and share live data with out displaying any personal identification.</p>

  </div><a class="u-url" href="/2016/05/18/modifying-test-data-for-privacy/" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Chris Miller&#39;s 4th Blog</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Chris Miller&#39;s 4th Blog</li><li><a class="u-email" href="mailto:your-email@example.com">your-email@example.com</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/anotherlab"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">anotherlab</span></a></li><li><a href="https://www.twitter.com/anotherlab"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">anotherlab</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>Write an awesome description for your new site here. You can edit this line in _config.yml. It will appear in your document head meta (for Google search results) and in your feed.xml site description.</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
