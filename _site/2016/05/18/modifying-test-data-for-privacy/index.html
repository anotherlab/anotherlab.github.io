<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.24.0 by Michael Rose
  Copyright 2013-2020 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Modifying test data for privacy - Chris Miller’s 4th Blog</title>
<meta name="description" content="Sometimes I get actual live data from a client to track down a bug that only happens with their data.  That data will contain student records and we don’t like to have live student laying around.   We can use TDE to encrypt the data at rest, but if I’m sharing that data with other developers, I want to scrub identifying details from data set.">


  <meta name="author" content="Chris Miller">
  
  <meta property="article:author" content="Chris Miller">
  


<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="Chris Miller's 4th Blog">
<meta property="og:title" content="Modifying test data for privacy">
<meta property="og:url" content="http://localhost:4000/2016/05/18/modifying-test-data-for-privacy/">


  <meta property="og:description" content="Sometimes I get actual live data from a client to track down a bug that only happens with their data.  That data will contain student records and we don’t like to have live student laying around.   We can use TDE to encrypt the data at rest, but if I’m sharing that data with other developers, I want to scrub identifying details from data set.">





  <meta name="twitter:site" content="@anotherlab">
  <meta name="twitter:title" content="Modifying test data for privacy">
  <meta name="twitter:description" content="Sometimes I get actual live data from a client to track down a bug that only happens with their data.  That data will contain student records and we don’t like to have live student laying around.   We can use TDE to encrypt the data at rest, but if I’m sharing that data with other developers, I want to scrub identifying details from data set.">
  <meta name="twitter:url" content="http://localhost:4000/2016/05/18/modifying-test-data-for-privacy/">

  
    <meta name="twitter:card" content="summary">
    
  

  



  <meta property="article:published_time" content="2016-05-18T16:08:15-04:00">






<link rel="canonical" href="http://localhost:4000/2016/05/18/modifying-test-data-for-privacy/">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": "Chris Miller",
      "url": "http://localhost:4000/"
    
  }
</script>







<!-- end _includes/seo.html -->



  <link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Chris Miller's 4th Blog Feed">


<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css"></noscript>



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--post">
    <nav class="skip-links">
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
        <a class="site-title" href="/">
          Chris Miller's 4th Blog
          
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/posts/">Posts</a>
            </li><li class="masthead__menu-item">
              <a href="/categories/">Categories</a>
            </li><li class="masthead__menu-item">
              <a href="/tags/">Tags</a>
            </li><li class="masthead__menu-item">
              <a href="/about/">About</a>
            </li></ul>
        
        <button class="search__toggle" type="button">
          <span class="visually-hidden">Toggle search</span>
          <i class="fas fa-search"></i>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Modifying test data for privacy</h1>
    <p class="post-meta"><time class="dt-published" datetime="2016-05-18T16:08:15-04:00" itemprop="datePublished">
        May 18, 2016
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p>Sometimes I get actual live data from a client to track down a bug that only happens with their data.  That data will contain student records and we don’t like to have live student laying around.   We can use <a href="https://msdn.microsoft.com/en-us/library/bb934049.aspx">TDE</a> to encrypt the data at rest, but if I’m sharing that data with other developers, I want to scrub identifying details from data set.</p>

<p>For the most part, I just need to replace the first and last names from student table.  I could set both the first and last names to “<a href="http://www.ganksoft.com/">Gank</a>“, but if every record looks the same, it can be hard to see how the bug manifests itself.  I could set both attributes to the record id value for the record, but I find that hard to look at after a while.</p>

<p>What I end up is writing some sort of reubenizer code.  The reubenizer changes the first and last names to some variation of “Reuben”.</p>

<div style="width: 160px" class="wp-caption aligncenter">
  <a href="https://en.wikipedia.org/wiki/Dave_Madden"><img loading="lazy" class="" src="https://i0.wp.com/photos.smugmug.com/photos/i-jQWQ4m4/0/Th/i-jQWQ4m4-Th.jpg?resize=150%2C150&#038;ssl=1" width="150" height="150" data-recalc-dims="1" /></a>
  
  <p class="wp-caption-text">
    The Patron Saint of all that is Reuben.  Dave Madden as Reuben Kincaid
  </p>
</div>

<p>Let’s create a fake table to represent the student data to modify.</p>

<pre class="brush:sql">declare @Student TABLE
(
    RecordID varchar(4),
    FirstName varchar(80),
    LastName varchar(80),
    Gender char(1)
);

-- Push in some fake data
insert into @Student (RecordID, FirstName, LastName, Gender) values (1, &#039;Joe&#039;, &#039;Smith&#039;, &#039;M&#039;);
insert into @Student (RecordID, FirstName, LastName, Gender) values (2, &#039;Joel&#039;, &#039;Smith&#039;, &#039;M&#039;);
insert into @Student (RecordID, FirstName, LastName, Gender) values (3, &#039;Jane&#039;, &#039;Smith&#039;, &#039;F&#039;);
insert into @Student (RecordID, FirstName, LastName, Gender) values (4, &#039;Linda&#039;, &#039;Tokken&#039;, &#039;F&#039;);
insert into @Student (RecordID, FirstName, LastName, Gender) values (5, &#039;Samantha&#039;, &#039;Queen&#039;, &#039;F&#039;);
insert into @Student (RecordID, FirstName, LastName, Gender) values (6, &#039;Steve&#039;, &#039;Burton&#039;, &#039;M&#039;);
insert into @Student (RecordID, FirstName, LastName, Gender) values (7, &#039;Doug&#039;, &#039;Francis&#039;, &#039;M&#039;);
insert into @Student (RecordID, FirstName, LastName, Gender) values (8, &#039;Linda&#039;, &#039;McLinda&#039;, &#039;F&#039;);
insert into @Student (RecordID, FirstName, LastName, Gender) values (9, &#039;Paul&#039;, &#039;Davis&#039;, &#039;M&#039;);
insert into @Student (RecordID, FirstName, LastName, Gender) values (10, &#039;Ann&#039;, &#039;Davis&#039;, &#039;F&#039;);
</pre>

<p>Running those statements will generate a result set that looks like this</p>

<pre>RecordID FirstName        LastName         Gender
-------- ---------------- ---------------- ------
1        Joe              Smith            M
2        Joel             Smith            M
3        Jane             Smith            F
4        Linda            Tokken           F
5        Samantha         Queen            F
6        Steve            Burton           M
7        Doug             Francis          M
8        Linda            McLinda          F
9        Paul             Davis            M
10       Ann              Davis            F
</pre>

<p>The first thing I do is create a table with a set of surname prefixes.  These prefixes will be used with the string “Reuben” to create the new last names</p>

<pre class="brush:sql">-- Create a table with some surname prefixes.  
-- We&#039;ll pick the prefix from the last digit of the record id of the student.
-- We only do this so we don&#039;t have to look at the same name for every row

declare @Reuben TABlE
(
    RecordID varchar(4),
    LastName varchar(16)
);

-- Pick 10 different prefixes
insert into @Reuben (RecordID, LastName) values (&#039;1&#039;, &#039;Mc&#039;);
insert into @Reuben (RecordID, LastName) values (&#039;2&#039;, &#039;de &#039;);
insert into @Reuben (RecordID, LastName) values (&#039;3&#039;, &#039;Del&#039;);
insert into @Reuben (RecordID, LastName) values (&#039;4&#039;, &#039;St &#039;);
insert into @Reuben (RecordID, LastName) values (&#039;5&#039;, &#039;Van &#039;);
insert into @Reuben (RecordID, LastName) values (&#039;6&#039;, &#039;Le &#039;);
insert into @Reuben (RecordID, LastName) values (&#039;7&#039;, &#039;La&#039;);
insert into @Reuben (RecordID, LastName) values (&#039;8&#039;, &#039;Lo&#039;);
insert into @Reuben (RecordID, LastName) values (&#039;9&#039;, &#039;O&#039;&#039;&#039;);
insert into @Reuben (RecordID, LastName) values (&#039;0&#039;, &#039;&#039;);
</pre>

<p>Now it’s time to create the update statement to reubenize the names. To get the surname prefix, we’ll get the last digit of the record id. That will slice up the students into 10 different sets of last names. There are other ways of doing this, this one is quick and simple. You could do the same thing with the first name, but in this case, I’m just going to use “Reuben” for the boys and “Reubenette” for the girls, and tack on that last digit.</p>

<p>To make the code a little cleaner, I use a <a href="https://msdn.microsoft.com/en-us/library/ms190766.aspx">Common Table Expression</a> (or CTE) to create a calculated field for the last digit of the record id. If you are not familair with CTE’s, they let you build temporary result sets that only exist within the context of the SQL expression that they are in.  I blogged about using a CTE <a href="http://www.rajapet.com/2016/02/generating-new-row-numbers-in-sql-based-on-a-starting-value.html">here</a> and <a href="http://www.rajapet.com/2010/04/suppressing-repeated-column-value-in.html">there</a>.</p>

<p>That update statement would look something like this</p>

<pre class="brush:sql">-- Using a CTE allows us to calculate the last digit just once
WITH cte (recordid, offset) 
     AS (SELECT recordid, 
                RIGHT(Cast(s.recordid AS VARCHAR), 1) AS OffSet 
         FROM   @student s) 
UPDATE s 
SET    s.lastname = Concat(r.lastname, &#039;Reuben&#039;), 
       s.firstname = CASE s.gender 
                       WHEN &#039;M&#039; THEN Concat(&#039;Reuben-&#039;, cte.recordid) 
                       ELSE Concat(&#039;Reubenette-&#039;, cte.recordid) 
                     END 
FROM   cte 
       JOIN @student s 
         ON cte.recordid = s.recordid 
       JOIN @Reuben r 
         ON r.recordid = cte.offset; 
</pre>

<p>After running that update statement, the result set will look like this</p>

<pre>RecordID FirstName        LastName         Gender
-------- ---------------- ---------------- ------
1        Reuben-1         McReuben         M
2        Reuben-2         de Reuben        M
3        Reubenette-3     DelReuben        F
4        Reubenette-4     St Reuben        F
5        Reubenette-5     Van Reuben       F
6        Reuben-6         Le Reuben        M
7        Reuben-7         LaReuben         M
8        Reubenette-8     LoReuben         F
9        Reuben-9         O&#039;Reuben         M
10       Reubenette-10    Reuben           F
</pre>

<p>The records are no longer recognizable and are distinct enough to allow me to debug the problem. This doesn’t work for every kind of data element, but it allows me to work with and share live data with out displaying any personal identification.</p>

  </div><a class="u-url" href="/2016/05/18/modifying-test-data-for-privacy/" hidden></a>
</article>

    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap"><form class="search-content__form" onkeydown="return event.key != 'Enter';" role="search">
    <label class="sr-only" for="search">
      Enter your search term...
    </label>
    <input type="search" id="search" class="search-input" tabindex="-1" placeholder="Enter your search term..." />
  </form>
  <div id="results" class="results"></div></div>

      </div>
    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    

    
      
        
          <li><a href="https://twitter.com/" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter</a></li>
        
      
        
          <li><a href="https://github.com/" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
        
      
        
          <li><a href="https://instagram.com/" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-instagram" aria-hidden="true"></i> Instagram</a></li>
        
      
    

    
      <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
    
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2021 Chris Miller. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>




<script src="/assets/js/lunr/lunr.min.js"></script>
<script src="/assets/js/lunr/lunr-store.js"></script>
<script src="/assets/js/lunr/lunr-en.js"></script>




    <script>
  'use strict';

  (function() {
    var commentContainer = document.querySelector('#utterances-comments');

    if (!commentContainer) {
      return;
    }

    var script = document.createElement('script');
    script.setAttribute('src', 'https://utteranc.es/client.js');
    script.setAttribute('repo', '');
    script.setAttribute('issue-term', 'pathname');
    
    script.setAttribute('theme', 'github-light');
    script.setAttribute('crossorigin', 'anonymous');

    commentContainer.appendChild(script);
  })();
</script>

  





  </body>
</html>
