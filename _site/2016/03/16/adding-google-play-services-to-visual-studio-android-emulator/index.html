<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.24.0 by Michael Rose
  Copyright 2013-2020 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Adding Google Play Services to Visual Studio Android Emulator - Chris Miller’s 4th Blog</title>
<meta name="description" content="">


  <meta name="author" content="Chris Miller">
  
  <meta property="article:author" content="Chris Miller">
  


<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="Chris Miller's 4th Blog">
<meta property="og:title" content="Adding Google Play Services to Visual Studio Android Emulator">
<meta property="og:url" content="/2016/03/16/adding-google-play-services-to-visual-studio-android-emulator/">


  <meta property="og:description" content="">





  <meta name="twitter:site" content="@anotherlab">
  <meta name="twitter:title" content="Adding Google Play Services to Visual Studio Android Emulator">
  <meta name="twitter:description" content="">
  <meta name="twitter:url" content="/2016/03/16/adding-google-play-services-to-visual-studio-android-emulator/">

  
    <meta name="twitter:card" content="summary">
    
  

  



  <meta property="article:published_time" content="2016-03-16T17:02:38-04:00">






<link rel="canonical" href="/2016/03/16/adding-google-play-services-to-visual-studio-android-emulator/">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": "Chris Miller",
      "url": "/"
    
  }
</script>







<!-- end _includes/seo.html -->



  <link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Chris Miller's 4th Blog Feed">


<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css"></noscript>



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--post">
    <nav class="skip-links">
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
        <a class="site-title" href="/">
          Chris Miller's 4th Blog
          
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/posts/">Posts</a>
            </li><li class="masthead__menu-item">
              <a href="/categories/">Categories</a>
            </li><li class="masthead__menu-item">
              <a href="/tags/">Tags</a>
            </li><li class="masthead__menu-item">
              <a href="/about/">About</a>
            </li></ul>
        
        <button class="search__toggle" type="button">
          <span class="visually-hidden">Toggle search</span>
          <i class="fas fa-search"></i>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Adding Google Play Services to Visual Studio Android Emulator</h1>
    <p class="post-meta"><time class="dt-published" datetime="2016-03-16T17:02:38-04:00" itemprop="datePublished">
        Mar 16, 2016
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p><img loading="lazy" class="alignnone" src="https://i1.wp.com/www.rajapet.net/photos/i-R5kKSrR/0/S/i-R5kKSrR-S.jpg?resize=400%2C251" alt="" width="400" height="251" /></p>

<p>Out of the box, the <a href="https://www.visualstudio.com/en-us/features/msft-android-emulator-vs.aspx">Visual Studio Android Emulator</a> (and the <a href="https://www.genymotion.com/">Genymotion emulator</a>, and the <a href="https://xamarin.com/android-player">Xamarin Android Player</a>) does not support Google Cloud Messaging (GCM) push notifications.  The reason for this is that GCM is part of the Google Play Services.  And the Google Play Services are not included in the virtual machine (VM) images that the Visual Studio Android Emulator uses.</p>

<p>The typical Android device starts with a base Android stack that comes from the <a href="https://source.android.com/">Android Open Source Project</a> (AOSP).  Device OEMS (Samsung, Huawei, LG, etc) then license the Google Play Services from Google.  On top of that, the OEMs add any customizations that they do to Android.</p>

<p>Google does not allow Microsoft/Genymotion/Xamarin to include the Google Play Services with their builds from the AOSP.  Enough developers have put together versions of the package so that it’s a fairly easy process to install. They are commonly packaged under the name “GApps”.</p>

<p>Run the Visual Studio Emulator for Android from the Start Menu.  If you run it from VS, you may not be able to install firmware packages.  Then create a new VM.  For this example, we’ll create an Android 5.1 VM.  I tried this with Android 6 and it did not work with the GApps packages that I was able to obtain.</p>

<div style="width: 329px" class="wp-caption alignnone">
  <a href="https://i1.wp.com/www.rajapet.net/photos/i-2Zkg8TJ/0/L/i-2Zkg8TJ-L.png"><img loading="lazy" class="" src="https://i0.wp.com/www.rajapet.net/photos/i-2Zkg8TJ/0/S/i-2Zkg8TJ-S.png?resize=319%2C300" alt="" width="319" height="300" /></a>
  
  <p class="wp-caption-text">
    Emulation Manager
  </p>
</div>

<p>If you are using an existing VM, you’ll need to know which CPU architecture or ABI that the VM is running under.  Thanks to a <a href="https://software.intel.com/en-us/blogs/2014/12/16/how-to-identify-the-image-is-32-bit-or-64-bit-user-space">tip from the nutty people at Intel</a>, you can execute an ADB command to see what is on board.</p>

<pre class="brush:powershell">adb shell getprop ro.product.cpu.abilist
</pre>

<p>Also see the documentation for the <a href="http://developer.android.com/reference/android/os/Build.html">Build</a> class.</p>

<p>SInce we created the VM, we know it’s Android 5.1.  If you were working with VM and were not sure of the version, you can check via the Android Settings app or from the command line with the adb command.</p>

<pre class="brush:powershell">adb shell getprop ro.build.version.release</pre>

<p>While we are checking stuff with ADB, the following command will return the SDK version</p>

<pre class="brush:powershell">adb shell getprop ro.build.version.sdk</pre>

<div style="width: 410px" class="wp-caption alignnone">
  <a href="https://i0.wp.com/www.rajapet.net/photos/i-6S78rKq/0/M/i-6S78rKq-M.png"><img loading="lazy" class="" src="https://i0.wp.com/www.rajapet.net/photos/i-6S78rKq/0/S/i-6S78rKq-S.png?resize=400%2C289" alt="Results from the ADB commands" width="400" height="289" /></a>
  
  <p class="wp-caption-text">
    Results from the ADB commands
  </p>
</div>

<p>First up is the installation of an ARM translator. The VS Android Emulator gets its speed by running an x86 version of Android. The Google Play Services are usually packed up already compiled for ARM. The ARM translator lets ARM code run on an x86 image. This is usually packaged up in a .zip named ARM Translation v1.1.</p>

<p>Installing is easy, drag the .zip on to a running Android VM and follow the prompts.</p>

<div style="width: 244px" class="wp-caption alignnone">
  <a href="https://i1.wp.com/www.rajapet.net/photos/i-Dfp2FZc/0/XL/i-Dfp2FZc-XL.png"><img loading="lazy" class="" src="https://i1.wp.com/www.rajapet.net/photos/i-Dfp2FZc/0/M/i-Dfp2FZc-M.png?resize=234%2C450" alt="" width="234" height="450" /></a>
  
  <p class="wp-caption-text">
    The dialog that appears after drag and drop the ARM Translator package onto the Android VM
  </p>
</div>

<p>If it didn’t reboot the VM, reboot it to be safe.  Multiple web sites have a copy of this file.  I downloaded one from the <a href="http://www.techbae.com/download-install-arm-translation-v1-1-zip-genymotion/">Tech Bae</a> blog.</p>

<div style="width: 362px" class="wp-caption alignnone">
  <img loading="lazy" class="" src="https://i0.wp.com/www.rajapet.net/photos/i-B54p3Pb/0/O/i-B54p3Pb.png?resize=352%2C179" alt="" width="352" height="179" />
  
  <p class="wp-caption-text">
    ARM Translator installed
  </p>
</div>

<p>Since we have Android 5.1, we need a GApps package for Android 5.1.  There are a few places where you can download a package from, but not all of them may work.  I was hoping to to use the packages on the <a href="http://opengapps.org/">Open Gapps</a> project.  None of their packages would install into my VMs.  They all reported an invalid folder error message.</p>

<p>The file sets available from <a href="http://www.teamandroid.com/gapps/">TeamAndroid</a> should install without any problems.  I downloaded one named gapps-lp-20150314.zip.  The “lp” in the file name stands for Lollypop, the code name for Android 5.</p>

<p>Drag the gapps package and drop it on your Android VM.  You should get a dialog like this:</p>

<p><img loading="lazy" class="alignnone" src="https://i2.wp.com/www.rajapet.net/photos/i-WRKdg93/1/O/i-WRKdg93.png?resize=426%2C179" alt="" width="426" height="179" /></p>

<p>Click the install button and let it do it’s thing.  After it completes, it should shutdown.  Restart it from the Emulator Manager.  After Android starts up, you may see a “Optimizing app X of Y” dialog.  When Android versions upgrade, the apps all need to tuned for the new version.  This is normal.</p>

<p><img loading="lazy" class="alignnone" src="https://i1.wp.com/www.rajapet.net/photos/i-fwHkhXr/2/O/i-fwHkhXr.png?resize=403%2C160" alt="" width="403" height="160" /></p>

<p>When that is all done, you should see  the Google Play icon in the app drawer.  Launch the app and provide your Google account information.  If you see an endless busy indicator, let it go for a minute, then close and restart Google Play.</p>

<p>You may see an error message about Google Play services having stopped.  That is normal and should go away once the Google Play services have been updated.</p>

<p>After installing GApps, some (many) Google apps and services will probably crash. Do not be alarmed, that is perfectly normal. Most of the files are out of date.</p>

<p><img loading="lazy" class="alignnone" src="https://i1.wp.com/www.rajapet.net/photos/i-NXxS8Tp/2/O/i-NXxS8Tp.png?resize=403%2C165" alt="" width="403" height="165" /></p>

<p>Get the Google Play app to run long enough for you to login and it will start updating.  To force Google Play to update itself, do the following (from <a href="http://www.androidcentral.com/how-update-your-google-play-store-without-sideloading-savage">Android Central</a>):</p>

<ol>
  <li>Launch Google Play</li>
  <li>Slide out the menu</li>
  <li>Tap on Settings</li>
  <li>Scroll to the bottom and tap Build version</li>
</ol>

<p>If a newer version is a available, you’ll see a dialog with that information.</p>

<p><img loading="lazy" class="alignnone" src="https://i0.wp.com/www.rajapet.net/photos/i-G92qSgW/1/O/i-G92qSgW.png?resize=403%2C717" alt="" width="403" height="717" /></p>

<p>At that point, your Android VM will support push notifications.  You can install of Google Play apps like the Maps application.  These steps were tested with Visual Studio Android Emulator but they should work more or less in the same way with the Genymotion and Xamarin emulators.</p>

<p><span style="line-height: 1.5;">The </span><a style="line-height: 1.5;" href="http://opengapps.org/.">Open GApps</a> <span style="line-height: 1.5;">page looks like it is a promising location to get GApp packages, they have a list of variants.  Basically each variant has more or less of the Google Apps.  To keep things simple, I wanted to use the stock version.  There is a naming scheme for gapps distributions.  It follows the pattern DistName-abi-version-variant-date.zip or a subset of that pattern</span></p>

<p>For this example, I had downloaded the full version of the x86 Android 6.0 GApps.  that came down with the following command line.</p>

<p>open_gapps-x86-6.0-stock-20160316.zip</p>

<p>It wouldn’t install, but that is the accepted pattern for naming GApp packages.  It (and the ARM version) error-ed out with an invalid directory message.  Hopefully this will be addressed in an update to the Visual Studio Android Emulator.</p>

<p>This article’s banner image comes from <a href="http://arena4g.com/2015/09/aprenda-um-novo-metodo-para-instalar-apps-android-no-windows-10-mobile.html">Arena4G</a>.</p>

  </div><a class="u-url" href="/2016/03/16/adding-google-play-services-to-visual-studio-android-emulator/" hidden></a>
</article>

    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap"><form class="search-content__form" onkeydown="return event.key != 'Enter';" role="search">
    <label class="sr-only" for="search">
      Enter your search term...
    </label>
    <input type="search" id="search" class="search-input" tabindex="-1" placeholder="Enter your search term..." />
  </form>
  <div id="results" class="results"></div></div>

      </div>
    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    

    
      
        
          <li><a href="https://twitter.com/anotherlab" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter</a></li>
        
      
        
          <li><a href="https://github.com/anotherlab" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
        
      
        
          <li><a href="https://www.linkedin.com/in/christophermiller/" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i> LinkedIn</a></li>
        
      
        
          <li><a href="https://instagram.com/anotherlab" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-instagram" aria-hidden="true"></i> Instagram</a></li>
        
      
        
          <li><a href="https://mvp.microsoft.com/en-us/PublicProfile/5000200" rel="nofollow noopener noreferrer"><i class="fas fa-fw fa-award" aria-hidden="true"></i> Microsoft MVP</a></li>
        
      
    

    
      <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
    
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2021 Chris Miller. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>




<script src="/assets/js/lunr/lunr.min.js"></script>
<script src="/assets/js/lunr/lunr-store.js"></script>
<script src="/assets/js/lunr/lunr-en.js"></script>




    <script>
  'use strict';

  (function () {
    var commentContainer = document.querySelector('#giscus-comments');

    if (!commentContainer) {
      return;
    }

    var script = document.createElement('script');
    script.setAttribute('src', 'https://giscus.app/client.js');
    script.setAttribute('data-repo', 'anotherlab/anotherlab.github.io');
    script.setAttribute('data-repo-id', '');
    script.setAttribute('data-category', '');
    script.setAttribute('data-category-id', '');
    script.setAttribute('data-mapping', 'pathname');
    script.setAttribute('data-reactions-enabled', '1');
    script.setAttribute('data-theme', 'light');
    script.setAttribute('crossorigin', 'anonymous');

    commentContainer.appendChild(script);
  })();
</script>
  





  </body>
</html>
