<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Adding Google Play Services to Visual Studio Android Emulator | Chris Miller’s 4th Blog</title>
<meta name="generator" content="Jekyll v4.2.1" />
<meta property="og:title" content="Adding Google Play Services to Visual Studio Android Emulator" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Write an awesome description for your new site here. You can edit this line in _config.yml. It will appear in your document head meta (for Google search results) and in your feed.xml site description." />
<meta property="og:description" content="Write an awesome description for your new site here. You can edit this line in _config.yml. It will appear in your document head meta (for Google search results) and in your feed.xml site description." />
<link rel="canonical" href="http://localhost:4000/2016/03/16/adding-google-play-services-to-visual-studio-android-emulator/" />
<meta property="og:url" content="http://localhost:4000/2016/03/16/adding-google-play-services-to-visual-studio-android-emulator/" />
<meta property="og:site_name" content="Chris Miller’s 4th Blog" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2016-03-16T17:02:38-04:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Adding Google Play Services to Visual Studio Android Emulator" />
<script type="application/ld+json">
{"datePublished":"2016-03-16T17:02:38-04:00","@type":"BlogPosting","url":"http://localhost:4000/2016/03/16/adding-google-play-services-to-visual-studio-android-emulator/","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/2016/03/16/adding-google-play-services-to-visual-studio-android-emulator/"},"dateModified":"2016-03-16T17:02:38-04:00","description":"Write an awesome description for your new site here. You can edit this line in _config.yml. It will appear in your document head meta (for Google search results) and in your feed.xml site description.","headline":"Adding Google Play Services to Visual Studio Android Emulator","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="Chris Miller's 4th Blog" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">Chris Miller&#39;s 4th Blog</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">About</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Adding Google Play Services to Visual Studio Android Emulator</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2016-03-16T17:02:38-04:00" itemprop="datePublished">Mar 16, 2016
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p><img loading="lazy" class="alignnone" src="https://i1.wp.com/www.rajapet.net/photos/i-R5kKSrR/0/S/i-R5kKSrR-S.jpg?resize=400%2C251" alt="" width="400" height="251" data-recalc-dims="1" /></p>

<p>Out of the box, the <a href="https://www.visualstudio.com/en-us/features/msft-android-emulator-vs.aspx">Visual Studio Android Emulator</a> (and the <a href="https://www.genymotion.com/">Genymotion emulator</a>, and the <a href="https://xamarin.com/android-player">Xamarin Android Player</a>) does not support Google Cloud Messaging (GCM) push notifications.  The reason for this is that GCM is part of the Google Play Services.  And the Google Play Services are not included in the virtual machine (VM) images that the Visual Studio Android Emulator uses.</p>

<p>The typical Android device starts with a base Android stack that comes from the <a href="https://source.android.com/">Android Open Source Project</a> (AOSP).  Device OEMS (Samsung, Huawei, LG, etc) then license the Google Play Services from Google.  On top of that, the OEMs add any customizations that they do to Android.</p>

<p>Google does not allow Microsoft/Genymotion/Xamarin to include the Google Play Services with their builds from the AOSP.  Enough developers have put together versions of the package so that it’s a fairly easy process to install. They are commonly packaged under the name “GApps”.</p>

<p>Run the Visual Studio Emulator for Android from the Start Menu.  If you run it from VS, you may not be able to install firmware packages.  Then create a new VM.  For this example, we’ll create an Android 5.1 VM.  I tried this with Android 6 and it did not work with the GApps packages that I was able to obtain.</p>

<div style="width: 329px" class="wp-caption alignnone">
  <a href="https://i1.wp.com/www.rajapet.net/photos/i-2Zkg8TJ/0/L/i-2Zkg8TJ-L.png"><img loading="lazy" class="" src="https://i0.wp.com/www.rajapet.net/photos/i-2Zkg8TJ/0/S/i-2Zkg8TJ-S.png?resize=319%2C300" alt="" width="319" height="300" data-recalc-dims="1" /></a>
  
  <p class="wp-caption-text">
    Emulation Manager
  </p>
</div>

<p>If you are using an existing VM, you’ll need to know which CPU architecture or ABI that the VM is running under.  Thanks to a <a href="https://software.intel.com/en-us/blogs/2014/12/16/how-to-identify-the-image-is-32-bit-or-64-bit-user-space">tip from the nutty people at Intel</a>, you can execute an ADB command to see what is on board.</p>

<pre class="brush:powershell">adb shell getprop ro.product.cpu.abilist
</pre>

<p>Also see the documentation for the <a href="http://developer.android.com/reference/android/os/Build.html">Build</a> class.</p>

<p>SInce we created the VM, we know it’s Android 5.1.  If you were working with VM and were not sure of the version, you can check via the Android Settings app or from the command line with the adb command.</p>

<pre class="brush:powershell">adb shell getprop ro.build.version.release</pre>

<p>While we are checking stuff with ADB, the following command will return the SDK version</p>

<pre class="brush:powershell">adb shell getprop ro.build.version.sdk</pre>

<div style="width: 410px" class="wp-caption alignnone">
  <a href="https://i0.wp.com/www.rajapet.net/photos/i-6S78rKq/0/M/i-6S78rKq-M.png"><img loading="lazy" class="" src="https://i0.wp.com/www.rajapet.net/photos/i-6S78rKq/0/S/i-6S78rKq-S.png?resize=400%2C289" alt="Results from the ADB commands" width="400" height="289" data-recalc-dims="1" /></a>
  
  <p class="wp-caption-text">
    Results from the ADB commands
  </p>
</div>

<p>First up is the installation of an ARM translator. The VS Android Emulator gets its speed by running an x86 version of Android. The Google Play Services are usually packed up already compiled for ARM. The ARM translator lets ARM code run on an x86 image. This is usually packaged up in a .zip named ARM Translation v1.1.</p>

<p>Installing is easy, drag the .zip on to a running Android VM and follow the prompts.</p>

<div style="width: 244px" class="wp-caption alignnone">
  <a href="https://i1.wp.com/www.rajapet.net/photos/i-Dfp2FZc/0/XL/i-Dfp2FZc-XL.png"><img loading="lazy" class="" src="https://i1.wp.com/www.rajapet.net/photos/i-Dfp2FZc/0/M/i-Dfp2FZc-M.png?resize=234%2C450" alt="" width="234" height="450" data-recalc-dims="1" /></a>
  
  <p class="wp-caption-text">
    The dialog that appears after drag and drop the ARM Translator package onto the Android VM
  </p>
</div>

<p>If it didn’t reboot the VM, reboot it to be safe.  Multiple web sites have a copy of this file.  I downloaded one from the <a href="http://www.techbae.com/download-install-arm-translation-v1-1-zip-genymotion/">Tech Bae</a> blog.</p>

<div style="width: 362px" class="wp-caption alignnone">
  <img loading="lazy" class="" src="https://i0.wp.com/www.rajapet.net/photos/i-B54p3Pb/0/O/i-B54p3Pb.png?resize=352%2C179" alt="" width="352" height="179" data-recalc-dims="1" />
  
  <p class="wp-caption-text">
    ARM Translator installed
  </p>
</div>

<p>Since we have Android 5.1, we need a GApps package for Android 5.1.  There are a few places where you can download a package from, but not all of them may work.  I was hoping to to use the packages on the <a href="http://opengapps.org/">Open Gapps</a> project.  None of their packages would install into my VMs.  They all reported an invalid folder error message.</p>

<p>The file sets available from <a href="http://www.teamandroid.com/gapps/">TeamAndroid</a> should install without any problems.  I downloaded one named gapps-lp-20150314.zip.  The “lp” in the file name stands for Lollypop, the code name for Android 5.</p>

<p>Drag the gapps package and drop it on your Android VM.  You should get a dialog like this:</p>

<p><img loading="lazy" class="alignnone" src="https://i2.wp.com/www.rajapet.net/photos/i-WRKdg93/1/O/i-WRKdg93.png?resize=426%2C179" alt="" width="426" height="179" data-recalc-dims="1" /></p>

<p>Click the install button and let it do it’s thing.  After it completes, it should shutdown.  Restart it from the Emulator Manager.  After Android starts up, you may see a “Optimizing app X of Y” dialog.  When Android versions upgrade, the apps all need to tuned for the new version.  This is normal.</p>

<p><img loading="lazy" class="alignnone" src="https://i1.wp.com/www.rajapet.net/photos/i-fwHkhXr/2/O/i-fwHkhXr.png?resize=403%2C160" alt="" width="403" height="160" data-recalc-dims="1" /></p>

<p>When that is all done, you should see  the Google Play icon in the app drawer.  Launch the app and provide your Google account information.  If you see an endless busy indicator, let it go for a minute, then close and restart Google Play.</p>

<p>You may see an error message about Google Play services having stopped.  That is normal and should go away once the Google Play services have been updated.</p>

<p>After installing GApps, some (many) Google apps and services will probably crash. Do not be alarmed, that is perfectly normal. Most of the files are out of date.</p>

<p><img loading="lazy" class="alignnone" src="https://i1.wp.com/www.rajapet.net/photos/i-NXxS8Tp/2/O/i-NXxS8Tp.png?resize=403%2C165" alt="" width="403" height="165" data-recalc-dims="1" /></p>

<p>Get the Google Play app to run long enough for you to login and it will start updating.  To force Google Play to update itself, do the following (from <a href="http://www.androidcentral.com/how-update-your-google-play-store-without-sideloading-savage">Android Central</a>):</p>

<ol>
  <li>Launch Google Play</li>
  <li>Slide out the menu</li>
  <li>Tap on Settings</li>
  <li>Scroll to the bottom and tap Build version</li>
</ol>

<p>If a newer version is a available, you’ll see a dialog with that information.</p>

<p><img loading="lazy" class="alignnone" src="https://i0.wp.com/www.rajapet.net/photos/i-G92qSgW/1/O/i-G92qSgW.png?resize=403%2C717" alt="" width="403" height="717" data-recalc-dims="1" /></p>

<p>At that point, your Android VM will support push notifications.  You can install of Google Play apps like the Maps application.  These steps were tested with Visual Studio Android Emulator but they should work more or less in the same way with the Genymotion and Xamarin emulators.</p>

<p><span style="line-height: 1.5;">The </span><a style="line-height: 1.5;" href="http://opengapps.org/.">Open GApps</a> <span style="line-height: 1.5;">page looks like it is a promising location to get GApp packages, they have a list of variants.  Basically each variant has more or less of the Google Apps.  To keep things simple, I wanted to use the stock version.  There is a naming scheme for gapps distributions.  It follows the pattern DistName-abi-version-variant-date.zip or a subset of that pattern</span></p>

<p>For this example, I had downloaded the full version of the x86 Android 6.0 GApps.  that came down with the following command line.</p>

<p>open_gapps-x86-6.0-stock-20160316.zip</p>

<p>It wouldn’t install, but that is the accepted pattern for naming GApp packages.  It (and the ARM version) error-ed out with an invalid directory message.  Hopefully this will be addressed in an update to the Visual Studio Android Emulator.</p>

<p>This article’s banner image comes from <a href="http://arena4g.com/2015/09/aprenda-um-novo-metodo-para-instalar-apps-android-no-windows-10-mobile.html">Arena4G</a>.</p>

  </div><a class="u-url" href="/2016/03/16/adding-google-play-services-to-visual-studio-android-emulator/" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Chris Miller&#39;s 4th Blog</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Chris Miller&#39;s 4th Blog</li><li><a class="u-email" href="mailto:your-email@example.com">your-email@example.com</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/anotherlab"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">anotherlab</span></a></li><li><a href="https://www.twitter.com/anotherlab"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">anotherlab</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>Write an awesome description for your new site here. You can edit this line in _config.yml. It will appear in your document head meta (for Google search results) and in your feed.xml site description.</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
